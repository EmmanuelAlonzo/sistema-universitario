<!doctype html>
<html lang="es" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema Universitario Completo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .demo-badge {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #ef4444;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
        }
        .schedule-grid {
            display: grid;
            grid-template-columns: 100px repeat(5, 1fr);
            gap: 1px;
            background: #e5e7eb;
        }
        .schedule-cell {
            background: white;
            padding: 8px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 12px;
        }
        .schedule-header {
            background: #f3f4f6;
            font-weight: bold;
        }
        .schedule-class {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-blue-50 to-indigo-100">
  <div class="demo-badge">
   DEMO
  </div><!-- BLOQUE 1: PANTALLA DE LOGIN --> <!-- Esta secci√≥n maneja la autenticaci√≥n inicial del usuario -->
  <div id="loginScreen" class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
   <div class="max-w-md w-full space-y-8 bg-white p-8 rounded-xl shadow-lg">
    <div class="text-center">
     <h2 id="universityTitle" class="text-3xl font-bold text-gray-900 mb-2">Universidad Nacional</h2>
     <p class="text-gray-600">Sistema de Gesti√≥n Acad√©mica</p>
     <div class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg">
      <p class="text-sm text-red-700"><strong>DEMO:</strong> Sistema de prueba para funcionalidad acad√©mica</p>
     </div>
    </div><!-- Formulario de login con campos de usuario y contrase√±a -->
    <div class="space-y-4">
     <div><label for="username" class="block text-sm font-medium text-gray-700">Usuario</label> <input id="username" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ingrese su usuario">
     </div>
     <div><label for="password" class="block text-sm font-medium text-gray-700">Contrase√±a</label> <input id="password" type="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ingrese su contrase√±a">
     </div><button onclick="login()" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"> Iniciar Sesi√≥n </button> <!-- Panel de usuarios de prueba - Informaci√≥n para testing -->
     <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
      <h3 class="text-sm font-medium text-blue-900 mb-3">üë• Usuarios de Prueba Disponibles:</h3>
      <div class="space-y-2 text-xs text-blue-800">
       <div class="grid grid-cols-2 gap-2">
        <div>
         <p class="font-semibold">üîß Administrador:</p>
         <p>Usuario: admin</p>
         <p>Contrase√±a: admin123</p>
        </div>
        <div>
         <p class="font-semibold">üë®‚Äçüíº Coordinador:</p>
         <p>Usuario: coord.sistemas</p>
         <p>Contrase√±a: coord123</p>
        </div>
       </div>
       <div class="grid grid-cols-2 gap-2">
        <div>
         <p class="font-semibold">üë®‚Äçüè´ Maestro:</p>
         <p>Usuario: prof.martinez</p>
         <p>Contrase√±a: prof123</p>
        </div>
        <div>
         <p class="font-semibold">üìã Secretaria:</p>
         <p>Usuario: sec.garcia</p>
         <p>Contrase√±a: sec123</p>
        </div>
       </div>
       <div class="text-center">
        <div>
         <p class="font-semibold">üíª Soporte IT:</p>
         <p>Usuario: it.support</p>
         <p>Contrase√±a: it123</p>
        </div>
       </div>
      </div>
      <p class="text-xs text-blue-600 mt-2 text-center">Los estudiantes pueden registrarse usando el bot√≥n de abajo</p>
     </div><!-- Opciones adicionales de login -->
     <div class="text-center space-y-2"><button onclick="showPasswordRecovery()" class="text-sm text-indigo-600 hover:text-indigo-500 block w-full"> ¬øOlvidaste tu contrase√±a? </button>
      <div class="border-t border-gray-200 pt-3">
       <p class="text-sm text-gray-600 mb-2">¬øEres nuevo estudiante?</p><button onclick="showRegisterModal()" class="w-full flex justify-center py-2 px-4 border border-indigo-600 rounded-md shadow-sm text-sm font-medium text-indigo-600 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"> Registrarse como Estudiante </button>
      </div>
     </div>
    </div>
   </div>
  </div><!-- BLOQUE 2: MODALES DE REGISTRO Y RECUPERACI√ìN --> <!-- Modal para registro de nuevos estudiantes -->
  <div id="registerModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><!-- El contenido se genera din√°micamente -->
  </div><!-- Modal para recuperaci√≥n de contrase√±a -->
  <div id="passwordRecoveryModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3">
     <h3 class="text-lg font-medium text-gray-900 mb-4">Recuperar Contrase√±a</h3>
     <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg mb-4">
      <p class="text-sm text-yellow-700">Esta es una simulaci√≥n de recuperaci√≥n de contrase√±a</p>
     </div>
     <div class="mb-4"><label for="recoveryEmail" class="block text-sm font-medium text-gray-700">Email</label> <input id="recoveryEmail" type="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="tu@email.com">
     </div>
     <div class="flex justify-end space-x-3"><button onclick="hidePasswordRecovery()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button> <button onclick="sendRecoveryEmail()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Enviar </button>
     </div>
    </div>
   </div>
  </div><!-- BLOQUE 3: DASHBOARD PRINCIPAL --> <!-- Interfaz principal despu√©s del login exitoso -->
  <div id="dashboard" class="hidden min-h-full"><!-- Header con informaci√≥n del usuario y controles -->
   <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex justify-between items-center py-4">
      <div class="flex items-center">
       <h1 id="dashboardTitle" class="text-2xl font-bold text-gray-900">Panel de Control</h1><span id="userRole" class="ml-4 px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm font-medium"></span>
      </div>
      <div class="flex items-center space-x-4"><span id="currentPeriod" class="text-sm text-gray-600">Per√≠odo: 2024-1</span> <span id="welcomeUser" class="text-sm text-gray-700 font-medium"></span> <button onclick="showChangePassword()" class="text-sm text-indigo-600 hover:text-indigo-500"> Cambiar Contrase√±a </button> <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium"> Cerrar Sesi√≥n </button>
      </div>
     </div>
    </div>
   </header><!-- Navegaci√≥n por pesta√±as seg√∫n el rol del usuario -->
   <nav class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex space-x-8" id="navigationTabs"><!-- Las pesta√±as se generan din√°micamente seg√∫n el rol -->
     </div>
    </div>
   </nav><!-- √Årea de contenido principal -->
   <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
    <div id="contentArea"><!-- El contenido se carga din√°micamente seg√∫n la pesta√±a seleccionada -->
    </div>
   </main>
  </div><!-- BLOQUE 4: MODALES ADICIONALES --> <!-- Modal para cambio de contrase√±a -->
  <div id="changePasswordModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
   <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3">
     <h3 class="text-lg font-medium text-gray-900 mb-4">Cambiar Contrase√±a</h3>
     <div class="space-y-4">
      <div><label for="currentPassword" class="block text-sm font-medium text-gray-700">Contrase√±a Actual</label> <input id="currentPassword" type="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      <div><label for="newPassword" class="block text-sm font-medium text-gray-700">Nueva Contrase√±a</label> <input id="newPassword" type="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
      </div>
      <div><label for="confirmPassword" class="block text-sm font-medium text-gray-700">Confirmar Contrase√±a</label> <input id="confirmPassword" type="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
      </div>
     </div>
     <div class="flex justify-end space-x-3 mt-6"><button onclick="hideChangePassword()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button> <button onclick="changePassword()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Cambiar </button>
     </div>
    </div>
   </div>
  </div><!-- Indicador de carga -->
  <div id="loadingIndicator" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
   <div class="bg-white p-6 rounded-lg shadow-lg">
    <div class="flex items-center space-x-3">
     <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"></div><span class="text-gray-700">Procesando...</span>
    </div>
   </div>
  </div>
  <script>
        // BLOQUE 5: VARIABLES GLOBALES Y CONFIGURACI√ìN
        // Variables para el estado de la aplicaci√≥n
        let currentUser = null;
        let currentUserData = null;
        let currentRole = null;
        let currentTab = null;
        let allData = [];
        let studentCounter = 1000;
        let employeeCounter = 100;

        // Configuraci√≥n por defecto del sistema
        const defaultConfig = {
            university_name: "Universidad Nacional",
            admin_email: "admin@universidad.edu",
            semester_period: "2024-1",
            primary_color: "#4f46e5",
            secondary_color: "#ffffff",
            text_color: "#1f2937",
            accent_color: "#059669",
            background_color: "#f8fafc"
        };

        // BLOQUE 6: DEFINICI√ìN DE MATERIAS POR CARRERA
        // Estructura de materias organizadas por carrera y semestre
        const subjectsByCareer = {
            'Ingenier√≠a en Sistemas': {
                '1': [
                    { code: 'MAT101', name: 'Matem√°tica I', credits: 4 },
                    { code: 'PRG101', name: 'Programaci√≥n I', credits: 4 },
                    { code: 'FIS101', name: 'F√≠sica I', credits: 3 },
                    { code: 'ING101', name: 'Ingl√©s I', credits: 2 }
                ],
                '2': [
                    { code: 'MAT102', name: 'Matem√°tica II', credits: 4 },
                    { code: 'PRG102', name: 'Programaci√≥n II', credits: 4 },
                    { code: 'FIS102', name: 'F√≠sica II', credits: 3 },
                    { code: 'ING102', name: 'Ingl√©s II', credits: 2 }
                ],
                '3': [
                    { code: 'EST201', name: 'Estructuras de Datos', credits: 4 },
                    { code: 'BDD201', name: 'Base de Datos I', credits: 4 },
                    { code: 'RED201', name: 'Redes I', credits: 3 },
                    { code: 'EST101', name: 'Estad√≠stica', credits: 3 }
                ],
                '4': [
                    { code: 'ALG301', name: 'Algoritmos', credits: 4 },
                    { code: 'BDD202', name: 'Base de Datos II', credits: 4 },
                    { code: 'RED202', name: 'Redes II', credits: 3 },
                    { code: 'ISW301', name: 'Ingenier√≠a de Software I', credits: 4 }
                ]
            },
            'Medicina': {
                '1': [
                    { code: 'ANA101', name: 'Anatom√≠a I', credits: 5 },
                    { code: 'BIO101', name: 'Biolog√≠a', credits: 4 },
                    { code: 'QUI101', name: 'Qu√≠mica', credits: 4 },
                    { code: 'BIF101', name: 'Biof√≠sica', credits: 3 }
                ],
                '2': [
                    { code: 'ANA102', name: 'Anatom√≠a II', credits: 5 },
                    { code: 'FIS201', name: 'Fisiolog√≠a I', credits: 4 },
                    { code: 'HIS201', name: 'Histolog√≠a', credits: 3 },
                    { code: 'EMB201', name: 'Embriolog√≠a', credits: 3 }
                ]
            },
            'Derecho': {
                '1': [
                    { code: 'DER101', name: 'Introducci√≥n al Derecho', credits: 4 },
                    { code: 'HIS101', name: 'Historia del Derecho', credits: 3 },
                    { code: 'SOC101', name: 'Sociolog√≠a Jur√≠dica', credits: 3 },
                    { code: 'MET101', name: 'Metodolog√≠a', credits: 2 }
                ],
                '2': [
                    { code: 'CIV201', name: 'Derecho Civil I', credits: 4 },
                    { code: 'CON201', name: 'Derecho Constitucional', credits: 4 },
                    { code: 'EST201', name: 'Teor√≠a del Estado', credits: 3 },
                    { code: 'FIL201', name: 'Filosof√≠a del Derecho', credits: 3 }
                ]
            },
            'Administraci√≥n': {
                '1': [
                    { code: 'ADM101', name: 'Fundamentos de Administraci√≥n', credits: 4 },
                    { code: 'MAT101', name: 'Matem√°tica Empresarial', credits: 3 },
                    { code: 'CON101', name: 'Contabilidad I', credits: 4 },
                    { code: 'ECO101', name: 'Econom√≠a I', credits: 3 }
                ],
                '2': [
                    { code: 'ADM201', name: 'Administraci√≥n de Personal', credits: 4 },
                    { code: 'EST201', name: 'Estad√≠stica', credits: 3 },
                    { code: 'CON102', name: 'Contabilidad II', credits: 4 },
                    { code: 'ECO102', name: 'Econom√≠a II', credits: 3 }
                ]
            }
        };

        // BLOQUE 7: PERMISOS POR ROL
        // Define qu√© puede hacer cada tipo de usuario
        const defaultPermissions = {
            'administrador': ['all'],
            'coordinador': ['manage_students', 'manage_teachers', 'assign_subjects', 'view_reports', 'manage_schedules'],
            'maestro': ['view_students', 'manage_grades', 'create_assignments', 'view_schedule'],
            'estudiante': ['view_grades', 'submit_assignments', 'view_schedule', 'access_forums'],
            'secretaria': ['manage_students', 'manage_documents', 'view_reports'],
            'soporte': ['manage_users', 'system_config', 'view_reports']
        };

        // BLOQUE 8: USUARIOS DE PRUEBA PREDEFINIDOS
        // Lista de usuarios administrativos para testing (cargados desde test_data.txt)
        const testUsers = [
            {
                id: 'admin_001',
                type: 'employee',
                name: 'Carlos Administrador',
                email: 'admin@universidad.edu',
                phone: '555-0001',
                role: 'administrador',
                employee_id: 'EMP001',
                username: 'admin',
                password: 'admin123',
                permissions: JSON.stringify(['all']),
                assigned_subjects: JSON.stringify([]),
                status: 'active'
            },
            {
                id: 'coord_001',
                type: 'employee',
                name: 'Mar√≠a Coordinadora Sistemas',
                email: 'coord.sistemas@universidad.edu',
                phone: '555-0002',
                role: 'coordinador',
                employee_id: 'EMP002',
                username: 'coord.sistemas',
                password: 'coord123',
                permissions: JSON.stringify(['manage_students', 'manage_teachers', 'assign_subjects', 'view_reports', 'manage_schedules']),
                assigned_subjects: JSON.stringify([]),
                status: 'active'
            },
            {
                id: 'teacher_001',
                type: 'employee',
                name: 'Dr. Roberto Mart√≠nez',
                email: 'prof.martinez@universidad.edu',
                phone: '555-0003',
                role: 'maestro',
                employee_id: 'EMP003',
                username: 'prof.martinez',
                password: 'prof123',
                permissions: JSON.stringify(['view_students', 'manage_grades', 'create_assignments', 'view_schedule']),
                assigned_subjects: JSON.stringify([
                    { code: 'PRG101', name: 'Programaci√≥n I', credits: 4, career: 'Ingenier√≠a en Sistemas', semester: '1' },
                    { code: 'PRG102', name: 'Programaci√≥n II', credits: 4, career: 'Ingenier√≠a en Sistemas', semester: '2' }
                ]),
                status: 'active'
            },
            {
                id: 'secretary_001',
                type: 'employee',
                name: 'Ana Garc√≠a Secretaria',
                email: 'sec.garcia@universidad.edu',
                phone: '555-0004',
                role: 'secretaria',
                employee_id: 'EMP004',
                username: 'sec.garcia',
                password: 'sec123',
                permissions: JSON.stringify(['manage_students', 'manage_documents', 'view_reports']),
                assigned_subjects: JSON.stringify([]),
                status: 'active'
            },
            {
                id: 'support_001',
                type: 'employee',
                name: 'Luis Soporte IT',
                email: 'it.support@universidad.edu',
                phone: '555-0005',
                role: 'soporte',
                employee_id: 'EMP005',
                username: 'it.support',
                password: 'it123',
                permissions: JSON.stringify(['manage_users', 'system_config', 'view_reports']),
                assigned_subjects: JSON.stringify([]),
                status: 'active'
            }
        ];
        
        // NOTA: Los datos detallados de los usuarios se encuentran en el archivo test_data.txt

        // BLOQUE 9: INICIALIZACI√ìN DEL SISTEMA
        // Handler para el Data SDK
        const dataHandler = {
            onDataChanged(data) {
                allData = data;
                if (currentTab) {
                    loadTabContent(currentTab);
                }
            }
        };

        // Funci√≥n principal de inicializaci√≥n
        async function initializeApp() {
            // Inicializar Data SDK
            if (window.dataSdk) {
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    console.error("Failed to initialize data SDK");
                    // Fallback: usar datos locales si el SDK no funciona
                    initializeLocalData();
                }
                
                // Crear usuarios de prueba si no existen
                await createTestUsersIfNeeded();
            } else {
                // Si no hay SDK, usar datos locales
                initializeLocalData();
                createTestUsersIfNeeded();
            }

            // Inicializar Element SDK para personalizaci√≥n
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        // Actualizar elementos visuales seg√∫n la configuraci√≥n
                        document.getElementById('universityTitle').textContent = config.university_name || defaultConfig.university_name;
                        document.getElementById('currentPeriod').textContent = `Per√≠odo: ${config.semester_period || defaultConfig.semester_period}`;
                        
                        // Aplicar colores personalizados
                        const primaryColor = config.primary_color || defaultConfig.primary_color;
                        const backgroundColor = config.background_color || defaultConfig.background_color;
                        const textColor = config.text_color || defaultConfig.text_color;

                        document.body.style.backgroundColor = backgroundColor;
                        
                        // Actualizar colores de botones
                        const buttons = document.querySelectorAll('.bg-indigo-600, .bg-indigo-500');
                        buttons.forEach(btn => {
                            btn.style.backgroundColor = primaryColor;
                        });

                        // Actualizar colores de texto
                        const textElements = document.querySelectorAll('.text-gray-900, .text-gray-800');
                        textElements.forEach(el => {
                            el.style.color = textColor;
                        });
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [
                            {
                                get: () => config.primary_color || defaultConfig.primary_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ primary_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.background_color || defaultConfig.background_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ background_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.text_color || defaultConfig.text_color,
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ text_color: value });
                                    }
                                }
                            }
                        ],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["university_name", config.university_name || defaultConfig.university_name],
                        ["admin_email", config.admin_email || defaultConfig.admin_email],
                        ["semester_period", config.semester_period || defaultConfig.semester_period]
                    ])
                });
            }
        }

        // Inicializar datos locales si el SDK no est√° disponible
        function initializeLocalData() {
            // Cargar usuarios de prueba desde el array local
            allData = [...testUsers];
            
            // Cargar estudiantes de ejemplo (datos detallados en test_data.txt)
            const sampleStudents = [
                {
                    id: 'student_1001',
                    type: 'student',
                    name: 'Juan P√©rez',
                    email: 'juan.perez@universidad.edu',
                    phone: '555-1001',
                    role: 'estudiante',
                    student_id: 'STU1001',
                    username: 'juan.perez',
                    password: 'est123',
                    career: 'Ingenier√≠a en Sistemas',
                    semester: '2',
                    courses: JSON.stringify([
                        { code: 'PRG101', name: 'Programaci√≥n I', credits: 4, semester: '1', teacher: 'Dr. Mart√≠nez', classroom: 'Aula 201', progress: 75 },
                        { code: 'MAT101', name: 'Matem√°tica I', credits: 4, semester: '1', teacher: 'Prof. Garc√≠a', classroom: 'Aula 105', progress: 80 }
                    ]),
                    status: 'active',
                    created_at: new Date().toISOString()
                },
                {
                    id: 'student_1002',
                    type: 'student',
                    name: 'Mar√≠a Gonz√°lez',
                    email: 'maria.gonzalez@universidad.edu',
                    phone: '555-1002',
                    role: 'estudiante',
                    student_id: 'STU1002',
                    username: 'maria.gonzalez',
                    password: 'est123',
                    career: 'Ingenier√≠a en Sistemas',
                    semester: '1',
                    courses: JSON.stringify([]),
                    status: 'active',
                    created_at: new Date().toISOString()
                }
            ];
            
            // NOTA: Los datos detallados de los estudiantes se encuentran en el archivo test_data.txt
            
            allData = [...allData, ...sampleStudents];
        }

        // BLOQUE 10: CREACI√ìN DE USUARIOS DE PRUEBA
        // Funci√≥n para crear usuarios administrativos autom√°ticamente
        async function createTestUsersIfNeeded() {
            const existingUsers = allData.filter(item => item.type === 'employee');
            
            // Solo crear usuarios si no existen
            if (existingUsers.length === 0) {
                for (const user of testUsers) {
                    user.created_at = new Date().toISOString();
                    if (window.dataSdk) {
                        await window.dataSdk.create(user);
                    } else {
                        // Fallback: agregar directamente al array local
                        allData.push(user);
                    }
                }
                
                // Crear estudiantes de ejemplo si no existen (datos detallados en test_data.txt)
                const existingStudents = allData.filter(item => item.type === 'student');
                if (existingStudents.length === 0) {
                    const sampleStudents = [
                        {
                            id: 'student_1001',
                            type: 'student',
                            name: 'Juan P√©rez',
                            email: 'juan.perez@universidad.edu',
                            phone: '555-1001',
                            role: 'estudiante',
                            student_id: 'STU1001',
                            username: 'juan.perez',
                            password: 'est123',
                            career: 'Ingenier√≠a en Sistemas',
                            semester: '2',
                            courses: JSON.stringify([
                                { code: 'PRG101', name: 'Programaci√≥n I', credits: 4, semester: '1', teacher: 'Dr. Mart√≠nez', classroom: 'Aula 201', progress: 75 },
                                { code: 'MAT101', name: 'Matem√°tica I', credits: 4, semester: '1', teacher: 'Prof. Garc√≠a', classroom: 'Aula 105', progress: 80 }
                            ]),
                            status: 'active',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 'student_1002',
                            type: 'student',
                            name: 'Mar√≠a Gonz√°lez',
                            email: 'maria.gonzalez@universidad.edu',
                            phone: '555-1002',
                            role: 'estudiante',
                            student_id: 'STU1002',
                            username: 'maria.gonzalez',
                            password: 'est123',
                            career: 'Ingenier√≠a en Sistemas',
                            semester: '1',
                            courses: JSON.stringify([]),
                            status: 'active',
                            created_at: new Date().toISOString()
                        }
                    ];
                                        
                    // NOTA: Los datos detallados de los estudiantes se encuentran en el archivo test_data.txt
                    
                    if (window.dataSdk) {
                        for (const student of sampleStudents) {
                            await window.dataSdk.create(student);
                        }
                    } else {
                        // Fallback: agregar directamente al array local
                        allData.push(...sampleStudents);
                    }
                }
            }
        }

        // BLOQUE 11: FUNCIONES DE AUTENTICACI√ìN
        // Funci√≥n principal de login
        // Funci√≥n principal de login con validaciones mejoradas
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Validaciones mejoradas
            if (!username.trim()) {
                showNotification('Por favor ingrese su nombre de usuario', 'error');
                return;
            }
            
            if (!password.trim()) {
                showNotification('Por favor ingrese su contrase√±a', 'error');
                return;
            }
            
            // Verificar longitud m√≠nima de contrase√±a
            if (password.length < 6) {
                showNotification('La contrase√±a debe tener al menos 6 caracteres', 'error');
                return;
            }

            showLoading();

            // Buscar usuario en la base de datos
            const user = allData.find(item => 
                (item.type === 'student' || item.type === 'employee') && 
                item.username === username && 
                item.password === password
            );

            if (!user) {
                showNotification('Usuario o contrase√±a incorrectos', 'error');
                hideLoading();
                return;
            }

            // Verificar estado del usuario
            if (user.status !== 'active') {
                showNotification('Su cuenta est√° desactivada. Contacte al administrador', 'error');
                hideLoading();
                return;
            }

            // Establecer sesi√≥n del usuario
            currentUser = username;
            currentUserData = user;
            currentRole = user.role;
            
            // Cambiar a la interfaz principal
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('userRole').textContent = getRoleDisplayName(user.role);
            document.getElementById('welcomeUser').textContent = `Bienvenido, ${user.name}`;
            
            setupNavigation();
            showNotification(`Bienvenido ${user.name}`, 'success');
            hideLoading();
        }

        // Funci√≥n para obtener nombre legible del rol
        function getRoleDisplayName(role) {
            const roleNames = {
                'administrador': 'Administrador',
                'coordinador': 'Coordinador',
                'maestro': 'Maestro',
                'estudiante': 'Estudiante',
                'secretaria': 'Secretaria',
                'soporte': 'Soporte IT'
            };
            return roleNames[role] || role;
        }

        // Funci√≥n de logout
        function logout() {
            currentUser = null;
            currentUserData = null;
            currentRole = null;
            currentTab = null;
            
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            showNotification('Sesi√≥n cerrada correctamente', 'success');
        }

        // BLOQUE 12: FUNCIONES DE NAVEGACI√ìN
        // Configurar pesta√±as seg√∫n el rol del usuario
        function setupNavigation() {
            const tabs = getTabsForRole(currentRole);
            const navContainer = document.getElementById('navigationTabs');
            
            navContainer.innerHTML = tabs.map(tab => `
                <button onclick="switchTab('${tab.id}')" 
                        class="nav-tab py-4 px-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300"
                        data-tab="${tab.id}">
                    ${tab.name}
                </button>
            `).join('');
            
            if (tabs.length > 0) {
                switchTab(tabs[0].id);
            }
        }

        // Obtener pesta√±as disponibles seg√∫n el rol
        function getTabsForRole(role) {
            const commonTabs = [
                { id: 'messages', name: 'Mensajes y Eventos' },
                { id: 'profile', name: 'Mi Perfil' }
            ];

            switch (role) {
                case 'administrador':
                    return [
                        { id: 'dashboard', name: 'Dashboard' },
                        { id: 'users', name: 'Gesti√≥n de Usuarios' },
                        { id: 'students', name: 'Estudiantes' },
                        { id: 'subjects', name: 'Asignaci√≥n de Materias' },
                        { id: 'schedules', name: 'Horarios' },
                        { id: 'reports', name: 'Reportes' },
                        ...commonTabs
                    ];
                case 'coordinador':
                    return [
                        { id: 'dashboard', name: 'Dashboard' },
                        { id: 'users', name: 'Gesti√≥n de Usuarios' },
                        { id: 'students', name: 'Estudiantes' },
                        { id: 'subjects', name: 'Asignaci√≥n de Materias' },
                        { id: 'schedules', name: 'Horarios' },
                        { id: 'grades', name: 'Calificaciones' },
                        ...commonTabs
                    ];
                case 'maestro':
                    return [
                        { id: 'dashboard', name: 'Dashboard' },
                        { id: 'mycourses', name: 'Mis Materias' },
                        { id: 'mystudents', name: 'Mis Estudiantes' },
                        { id: 'assignments', name: 'Tareas' },
                        { id: 'grades', name: 'Calificaciones' },
                        { id: 'schedule', name: 'Mi Horario' },
                        ...commonTabs
                    ];
                case 'estudiante':
                    return [
                        { id: 'dashboard', name: 'Dashboard' },
                        { id: 'mycourses', name: 'Mis Materias' },
                        { id: 'assignments', name: 'Mis Tareas' },
                        { id: 'grades', name: 'Mis Calificaciones' },
                        { id: 'forums', name: 'Foros' },
                        { id: 'schedule', name: 'Mi Horario' },
                        ...commonTabs
                    ];
                case 'secretaria':
                    return [
                        { id: 'dashboard', name: 'Dashboard' },
                        { id: 'students', name: 'Registro de Estudiantes' },
                        { id: 'enrollment', name: 'Inscripciones' },
                        { id: 'documents', name: 'Documentos' },
                        ...commonTabs
                    ];
                case 'soporte':
                    return [
                        { id: 'dashboard', name: 'Dashboard' },
                        { id: 'users', name: 'Gesti√≥n de Usuarios' },
                        { id: 'tickets', name: 'Tickets de Soporte' },
                        { id: 'system', name: 'Sistema' },
                        ...commonTabs
                    ];
                default:
                    return commonTabs;
            }
        }

        // Cambiar entre pesta√±as
        function switchTab(tabId) {
            // Actualizar pesta√±a activa visualmente
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            const activeTab = document.querySelector(`[data-tab="${tabId}"]`);
            if (activeTab) {
                activeTab.classList.remove('border-transparent', 'text-gray-500');
                activeTab.classList.add('border-indigo-500', 'text-indigo-600');
            }
            
            currentTab = tabId;
            loadTabContent(tabId);
        }

        // BLOQUE 13: CARGA DE CONTENIDO
        // Cargar contenido seg√∫n la pesta√±a seleccionada
        function loadTabContent(tabId) {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = '<div class="animate-pulse">Cargando...</div>';
            
            setTimeout(() => {
                switch (tabId) {
                    case 'dashboard':
                        loadDashboardContent();
                        break;
                    case 'students':
                        loadStudentsContent();
                        break;
                    case 'users':
                        loadUsersContent();
                        break;
                    case 'subjects':
                        loadSubjectsContent();
                        break;
                    case 'schedules':
                        loadSchedulesContent();
                        break;
                    case 'mycourses':
                        loadMyCoursesContent();
                        break;
                    case 'mystudents':
                        loadMyStudentsContent();
                        break;
                    case 'assignments':
                        loadAssignmentsContent();
                        break;
                    case 'grades':
                        loadGradesContent();
                        break;
                    case 'forums':
                        loadForumsContent();
                        break;
                    case 'schedule':
                        loadScheduleContent();
                        break;
                    case 'messages':
                        loadMessagesContent();
                        break;
                    case 'profile':
                        loadProfileContent();
                        break;
                    case 'enrollment':
                        loadEnrollmentContent();
                        break;
                    case 'reports':
                        loadReportsContent();
                        break;
                    case 'tickets':
                        loadTicketsContent();
                        break;
                    case 'documents':
                        loadDocumentsContent();
                        break;
                    case 'system':
                        loadSystemContent();
                        break;
                    default:
                        contentArea.innerHTML = '<div class="text-center py-12"><h3 class="text-lg font-medium text-gray-900">Contenido no disponible</h3></div>';
                }
            }, 300);
        }

        // BLOQUE 14: CONTENIDO DEL DASHBOARD
        // Dashboard personalizado seg√∫n el rol del usuario
        function loadDashboardContent() {
            const students = allData.filter(item => item.type === 'student');
            const employees = allData.filter(item => item.type === 'employee');
            const assignments = allData.filter(item => item.type === 'assignment');
            const messages = allData.filter(item => item.type === 'message' || item.type === 'event');

            let dashboardContent = '';

            if (currentRole === 'estudiante') {
                // Dashboard para estudiantes
                const mySubjects = currentUserData.courses ? JSON.parse(currentUserData.courses) : [];
                const myAssignments = assignments.filter(a => a.assigned_to === currentUser || a.assigned_to === 'Todos los estudiantes');
                const pendingAssignments = myAssignments.filter(a => a.status === 'pending');

                dashboardContent = `
                    <div class="fade-in">
                        <div class="mb-8">
                            <h1 class="text-2xl font-bold text-gray-900">Bienvenido, ${currentUserData.name}</h1>
                            <p class="text-gray-600">${currentUserData.career} - ${currentUserData.semester}¬∞ Semestre</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìö</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Mis Materias</dt>
                                                <dd class="text-lg font-medium text-gray-900">${mySubjects.length}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìù</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Tareas Pendientes</dt>
                                                <dd class="text-lg font-medium text-gray-900">${pendingAssignments.length}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìä</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Promedio</dt>
                                                <dd class="text-lg font-medium text-gray-900">85.5</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üïê</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Clases Hoy</dt>
                                                <dd class="text-lg font-medium text-gray-900">3</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üí≥</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Pagos Pendientes</dt>
                                                <dd class="text-lg font-medium text-gray-900">${currentUserData.payments ? JSON.parse(currentUserData.payments).filter(p => p.status !== 'completed').length : 0}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Mis Materias</h3>
                                <div class="space-y-3">
                                    ${mySubjects.length > 0 ? mySubjects.map(subject => `
                                        <div class="flex justify-between items-center border-b pb-2">
                                            <div>
                                                <p class="font-medium text-gray-900">${subject.name}</p>
                                                <p class="text-sm text-gray-500">${subject.code} ‚Ä¢ ${subject.credits} cr√©ditos</p>
                                            </div>
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">Activa</span>
                                        </div>
                                    `).join('') : '<p class="text-gray-500 text-sm">No tienes materias asignadas</p>'}
                                </div>
                            </div>

                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Pr√≥ximos Eventos</h3>
                                <div class="space-y-3">
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Entrega de Proyecto Final</p>
                                            <p class="text-xs text-gray-500">${new Date(new Date().setDate(new Date().getDate() + 5)).toLocaleDateString()}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Examen Parcial</p>
                                            <p class="text-xs text-gray-500">${new Date(new Date().setDate(new Date().getDate() + 12)).toLocaleDateString()}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentRole === 'maestro') {
                // Dashboard para maestros
                const assignedSubjects = currentUserData.assigned_subjects ? JSON.parse(currentUserData.assigned_subjects) : [];
                const myStudents = students.filter(s => {
                    const studentCourses = s.courses ? JSON.parse(s.courses) : [];
                    return assignedSubjects.some(subject => 
                        studentCourses.some(course => course.code === subject.code)
                    );
                });

                dashboardContent = `
                    <div class="fade-in">
                        <div class="mb-8">
                            <h1 class="text-2xl font-bold text-gray-900">Panel del Maestro</h1>
                            <p class="text-gray-600">${currentUserData.name}</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìö</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Materias Asignadas</dt>
                                                <dd class="text-lg font-medium text-gray-900">${assignedSubjects.length}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üë•</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Estudiantes</dt>
                                                <dd class="text-lg font-medium text-gray-900">${myStudents.length}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìù</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Tareas Pendientes</dt>
                                                <dd class="text-lg font-medium text-gray-900">${assignments.filter(a => a.created_by === currentUser).length}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìä</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Promedio General</dt>
                                                <dd class="text-lg font-medium text-gray-900">87.3</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Materias Asignadas</h3>
                                <div class="space-y-3">
                                    ${assignedSubjects.length > 0 ? assignedSubjects.map(subject => `
                                        <div class="flex justify-between items-center border-b pb-2">
                                            <div>
                                                <p class="font-medium text-gray-900">${subject.name}</p>
                                                <p class="text-sm text-gray-500">${subject.code} ‚Ä¢ ${subject.career} ‚Ä¢ Semestre ${subject.semester}</p>
                                            </div>
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">Activa</span>
                                        </div>
                                    `).join('') : '<p class="text-gray-500 text-sm">No tienes materias asignadas</p>'}
                                </div>
                            </div>

                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Actividad Reciente</h3>
                                <div class="space-y-3">
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm text-gray-900">Calificaciones actualizadas para Programaci√≥n I</p>
                                            <p class="text-xs text-gray-500">Hace 2 horas</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm text-gray-900">Nueva tarea asignada: Proyecto Final</p>
                                            <p class="text-xs text-gray-500">Hace 1 d√≠a</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Dashboard para administradores y personal
                dashboardContent = `
                    <div class="fade-in">
                        <div class="mb-8">
                            <h1 class="text-2xl font-bold text-gray-900">Panel de Control</h1>
                            <p class="text-gray-600">${getRoleDisplayName(currentRole)} - ${currentUserData.name}</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üë•</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Estudiantes</dt>
                                                <dd class="text-lg font-medium text-gray-900">${students.length}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üë®‚Äçüè´</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Empleados</dt>
                                                <dd class="text-lg font-medium text-gray-900">${employees.length}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìù</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Tareas Activas</dt>
                                                <dd class="text-lg font-medium text-gray-900">${assignments.length}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üì¢</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Mensajes</dt>
                                                <dd class="text-lg font-medium text-gray-900">${messages.length}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üí≥</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Pagos Pendientes</dt>
                                                <dd class="text-lg font-medium text-gray-900">12</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Estudiantes por Carrera</h3>
                                <div class="space-y-3">
                                    ${Object.entries(students.reduce((acc, student) => {
                                        acc[student.career] = (acc[student.career] || 0) + 1;
                                        return acc;
                                    }, {})).map(([career, count]) => `
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600">${career}</span>
                                            <span class="font-medium text-gray-900">${count}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Actividad Reciente</h3>
                                <div class="space-y-3">
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm text-gray-900">Nuevo estudiante registrado</p>
                                            <p class="text-xs text-gray-500">Hace 30 minutos</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm text-gray-900">Calificaciones actualizadas</p>
                                            <p class="text-xs text-gray-500">Hace 2 horas</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm text-gray-900">Sistema inicializado correctamente</p>
                                            <p class="text-xs text-gray-500">${new Date().toLocaleDateString()}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            document.getElementById('contentArea').innerHTML = dashboardContent;
        }

        // BLOQUE 15: FUNCIONES DE UTILIDAD
        // Funciones auxiliares para el funcionamiento del sistema

        // Mostrar notificaciones al usuario
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-md shadow-lg ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
                'bg-blue-100 text-blue-800 border border-blue-200'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Mostrar/ocultar indicador de carga
        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        // Funciones de modal para recuperaci√≥n de contrase√±a
        function showPasswordRecovery() {
            document.getElementById('passwordRecoveryModal').classList.remove('hidden');
        }

        function hidePasswordRecovery() {
            document.getElementById('passwordRecoveryModal').classList.add('hidden');
            document.getElementById('recoveryEmail').value = '';
        }

        function sendRecoveryEmail() {
            const email = document.getElementById('recoveryEmail').value;
            if (!email.trim()) {
                showNotification('Por favor ingrese un email', 'error');
                return;
            }
            
            showNotification(`Email de recuperaci√≥n enviado a ${email}`, 'success');
            hidePasswordRecovery();
        }

        // Funciones de cambio de contrase√±a
        function showChangePassword() {
            document.getElementById('changePasswordModal').classList.remove('hidden');
        }

        function hideChangePassword() {
            document.getElementById('changePasswordModal').classList.add('hidden');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        async function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (!current || !newPass || !confirm) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            if (current !== currentUserData.password) {
                showNotification('La contrase√±a actual es incorrecta', 'error');
                return;
            }
            
            if (newPass !== confirm) {
                showNotification('Las contrase√±as no coinciden', 'error');
                return;
            }

            if (newPass.length < 6) {
                showNotification('La nueva contrase√±a debe tener al menos 6 caracteres', 'error');
                return;
            }

            showLoading();
            
            currentUserData.password = newPass;
            
            // Actualizar en el array local tambi√©n
            const userIndex = allData.findIndex(item => item.id === currentUserData.id);
            if (userIndex !== -1) {
                allData[userIndex].password = newPass;
            }
            
            if (window.dataSdk) {
                const result = await window.dataSdk.update(currentUserData);
                if (result.isOk) {
                    showNotification('Contrase√±a cambiada exitosamente', 'success');
                    hideChangePassword();
                } else {
                    showNotification('Error al cambiar contrase√±a', 'error');
                }
            } else {
                // Fallback: mostrar √©xito ya que ya actualizamos el array local
                showNotification('Contrase√±a cambiada exitosamente', 'success');
                hideChangePassword();
            }
            
            hideLoading();
        }

        // BLOQUE 16: FUNCIONES DE CONTENIDO B√ÅSICO
        // Funciones placeholder para contenido que se desarrollar√° m√°s adelante

        // Cargar contenido de gesti√≥n de estudiantes
        function loadStudentsContent() {
            const students = allData.filter(item => item.type === 'student');
            
            let studentsContent = `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-xl font-semibold text-gray-900">Gesti√≥n de Estudiantes</h1>
                        <button onclick="showAddStudentModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            Agregar Estudiante
                        </button>
                    </div>
                    
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Carrera</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Semestre</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            students.forEach(student => {
                studentsContent += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.student_id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.career}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.semester}¬∞</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.email}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                student.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                            }">
                                ${student.status === 'active' ? 'Activo' : 'Inactivo'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button onclick="editStudent('${student.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Editar</button>
                            <button onclick="toggleStudentStatus('${student.id}')" class="text-red-600 hover:text-red-900">
                                ${student.status === 'active' ? 'Desactivar' : 'Activar'}
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            studentsContent += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = studentsContent;
        }

        // Cargar contenido de gesti√≥n de usuarios
        function loadUsersContent() {
            const employees = allData.filter(item => item.type === 'employee');
            
            let usersContent = `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-xl font-semibold text-gray-900">Gesti√≥n de Usuarios</h1>
                        <button onclick="showAddUserModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            Agregar Usuario
                        </button>
                    </div>
                    
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rol</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            employees.forEach(employee => {
                usersContent += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${employee.employee_id || employee.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${employee.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${employee.email}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${getRoleDisplayName(employee.role)}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                employee.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                            }">
                                ${employee.status === 'active' ? 'Activo' : 'Inactivo'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button onclick="editUser('${employee.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Editar</button>
                            <button onclick="toggleUserStatus('${employee.id}')" class="text-red-600 hover:text-red-900">
                                ${employee.status === 'active' ? 'Desactivar' : 'Activar'}
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            usersContent += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = usersContent;
        }

        // Mostrar modal para agregar usuario
        function showAddUserModal() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Agregar Nuevo Usuario</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="userName" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                                <input id="userName" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="userEmail" class="block text-sm font-medium text-gray-700">Email</label>
                                <input id="userEmail" type="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="userPhone" class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                                <input id="userPhone" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="userRole" class="block text-sm font-medium text-gray-700">Rol</label>
                                <select id="userRole" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione un rol</option>
                                    <option value="administrador">Administrador</option>
                                    <option value="coordinador">Coordinador</option>
                                    <option value="maestro">Maestro</option>
                                    <option value="secretaria">Secretaria</option>
                                    <option value="soporte">Soporte IT</option>
                                </select>
                            </div>
                            <div>
                                <label for="userUsername" class="block text-sm font-medium text-gray-700">Nombre de Usuario</label>
                                <input id="userUsername" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="userPassword" class="block text-sm font-medium text-gray-700">Contrase√±a</label>
                                <input id="userPassword" type="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="addUser()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Agregar </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Agregar nuevo usuario
        async function addUser() {
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const phone = document.getElementById('userPhone').value.trim();
            const role = document.getElementById('userRole').value;
            const username = document.getElementById('userUsername').value.trim();
            const password = document.getElementById('userPassword').value;
            
            // Validaciones
            if (!name || !email || !phone || !role || !username || !password) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('La contrase√±a debe tener al menos 6 caracteres', 'error');
                return;
            }
            
            // Verificar si el nombre de usuario ya existe
            const existingUser = allData.find(item => item.username === username);
            if (existingUser) {
                showNotification('El nombre de usuario ya est√° en uso', 'error');
                return;
            }
            
            showLoading();
            
            // Crear nuevo usuario
            const newUser = {
                id: `employee_${++employeeCounter}`,
                type: 'employee',
                name: name,
                email: email,
                phone: phone,
                role: role,
                employee_id: `EMP${employeeCounter}`,
                username: username,
                password: password,
                permissions: JSON.stringify(defaultPermissions[role] || []),
                assigned_subjects: JSON.stringify([]),
                status: 'active',
                created_at: new Date().toISOString()
            };
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.create(newUser);
                if (result.isOk) {
                    showNotification('Usuario agregado exitosamente', 'success');
                    hideRegisterModal();
                    // Actualizar datos locales
                    allData.push(newUser);
                    loadUsersContent();
                } else {
                    showNotification('Error al agregar usuario', 'error');
                }
            } else {
                // Fallback: agregar directamente al array local
                allData.push(newUser);
                showNotification('Usuario agregado exitosamente', 'success');
                hideRegisterModal();
                loadUsersContent();
            }
            
            hideLoading();
        }

        // Editar usuario
        function editUser(userId) {
            const user = allData.find(item => item.id === userId);
            if (!user) return;
            
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Editar Usuario</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="editUserName" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                                <input id="editUserName" type="text" value="${user.name}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="editUserEmail" class="block text-sm font-medium text-gray-700">Email</label>
                                <input id="editUserEmail" type="email" value="${user.email}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="editUserPhone" class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                                <input id="editUserPhone" type="text" value="${user.phone}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="editUserRole" class="block text-sm font-medium text-gray-700">Rol</label>
                                <select id="editUserRole" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="administrador" ${user.role === 'administrador' ? 'selected' : ''}>Administrador</option>
                                    <option value="coordinador" ${user.role === 'coordinador' ? 'selected' : ''}>Coordinador</option>
                                    <option value="maestro" ${user.role === 'maestro' ? 'selected' : ''}>Maestro</option>
                                    <option value="secretaria" ${user.role === 'secretaria' ? 'selected' : ''}>Secretaria</option>
                                    <option value="soporte" ${user.role === 'soporte' ? 'selected' : ''}>Soporte IT</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="updateUser('${userId}')" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Guardar </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Actualizar usuario
        async function updateUser(userId) {
            const user = allData.find(item => item.id === userId);
            if (!user) return;
            
            const name = document.getElementById('editUserName').value.trim();
            const email = document.getElementById('editUserEmail').value.trim();
            const phone = document.getElementById('editUserPhone').value.trim();
            const role = document.getElementById('editUserRole').value;
            
            // Validaciones
            if (!name || !email || !phone || !role) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            showLoading();
            
            // Actualizar datos del usuario
            user.name = name;
            user.email = email;
            user.phone = phone;
            user.role = role;
            
            // Actualizar permisos seg√∫n el nuevo rol
            user.permissions = JSON.stringify(defaultPermissions[role] || []);
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.update(user);
                if (result.isOk) {
                    showNotification('Usuario actualizado exitosamente', 'success');
                    hideRegisterModal();
                    loadUsersContent();
                } else {
                    showNotification('Error al actualizar usuario', 'error');
                }
            } else {
                // Fallback: los cambios ya est√°n en el array local
                showNotification('Usuario actualizado exitosamente', 'success');
                hideRegisterModal();
                loadUsersContent();
            }
            
            hideLoading();
        }

        // Cambiar estado del usuario
        async function toggleUserStatus(userId) {
            const user = allData.find(item => item.id === userId);
            if (!user) return;
            
            showLoading();
            
            // Cambiar estado
            user.status = user.status === 'active' ? 'inactive' : 'active';
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.update(user);
                if (result.isOk) {
                    showNotification(`Usuario ${user.status === 'active' ? 'activado' : 'desactivado'} exitosamente`, 'success');
                    loadUsersContent();
                } else {
                    showNotification('Error al cambiar estado del usuario', 'error');
                }
            } else {
                // Fallback: los cambios ya est√°n en el array local
                showNotification(`Usuario ${user.status === 'active' ? 'activado' : 'desactivado'} exitosamente`, 'success');
                loadUsersContent();
            }
            
            hideLoading();
        }

        // Cargar contenido de asignaci√≥n de materias
        function loadSubjectsContent() {
            // Obtener todas las carreras disponibles
            const careers = Object.keys(subjectsByCareer);
            
            // Obtener todos los maestros
            const teachers = allData.filter(item => item.type === 'employee' && item.role === 'maestro');
            
            let subjectsContent = `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-xl font-semibold text-gray-900">Asignaci√≥n de Materias</h1>
                        <button onclick="showAssignSubjectModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            Asignar Materia
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <div class="bg-white shadow rounded-lg overflow-hidden">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materia</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Carrera</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Semestre</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Maestro</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            // Generar lista de asignaciones
            teachers.forEach(teacher => {
                const assignedSubjects = teacher.assigned_subjects ? JSON.parse(teacher.assigned_subjects) : [];
                assignedSubjects.forEach(subject => {
                    subjectsContent += `
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${subject.name}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${subject.career}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${subject.semester}¬∞</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${teacher.name}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                <button onclick="editSubjectAssignment('${teacher.id}', '${subject.code}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Editar</button>
                                <button onclick="removeSubjectAssignment('${teacher.id}', '${subject.code}')" class="text-red-600 hover:text-red-900">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
            });
            
            subjectsContent += `
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div>
                            <div class="bg-white shadow rounded-lg p-6 mb-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Informaci√≥n</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Total de Materias</span>
                                        <span class="font-medium text-gray-900">${Object.values(subjectsByCareer).reduce((total, semesters) => total + Object.values(semesters).reduce((count, subjects) => count + subjects.length, 0), 0)}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Maestros Asignados</span>
                                        <span class="font-medium text-gray-900">${teachers.filter(t => t.assigned_subjects && JSON.parse(t.assigned_subjects).length > 0).length}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Asignaciones Totales</span>
                                        <span class="font-medium text-gray-900">${teachers.reduce((total, teacher) => total + (teacher.assigned_subjects ? JSON.parse(teacher.assigned_subjects).length : 0), 0)}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Carreras Disponibles</h3>
                                <div class="space-y-2">
                                    ${careers.map(career => `
                                        <div class="flex items-center">
                                            <div class="flex-shrink-0 w-3 h-3 bg-indigo-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-gray-700">${career}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = subjectsContent;
        }

        // Mostrar modal para asignar materia
        function showAssignSubjectModal() {
            const careers = Object.keys(subjectsByCareer);
            const teachers = allData.filter(item => item.type === 'employee' && item.role === 'maestro');
            
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Asignar Materia a Maestro</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="assignTeacher" class="block text-sm font-medium text-gray-700">Maestro</label>
                                <select id="assignTeacher" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione un maestro</option>
                                    ${teachers.map(teacher => `<option value="${teacher.id}">${teacher.name}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="assignCareer" class="block text-sm font-medium text-gray-700">Carrera</label>
                                <select id="assignCareer" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" onchange="loadSemestersAndSubjects()">
                                    <option value="">Seleccione una carrera</option>
                                    ${careers.map(career => `<option value="${career}">${career}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="assignSemester" class="block text-sm font-medium text-gray-700">Semestre</label>
                                <select id="assignSemester" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" onchange="loadSubjects()">
                                    <option value="">Seleccione un semestre</option>
                                </select>
                            </div>
                            <div>
                                <label for="assignSubject" class="block text-sm font-medium text-gray-700">Materia</label>
                                <select id="assignSubject" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione una materia</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="assignSubjectToTeacher()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Asignar </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Cargar semestres seg√∫n la carrera seleccionada
        function loadSemestersAndSubjects() {
            const career = document.getElementById('assignCareer').value;
            const semesterSelect = document.getElementById('assignSemester');
            const subjectSelect = document.getElementById('assignSubject');
            
            // Limpiar selects
            semesterSelect.innerHTML = '<option value="">Seleccione un semestre</option>';
            subjectSelect.innerHTML = '<option value="">Seleccione una materia</option>';
            
            if (career && subjectsByCareer[career]) {
                const semesters = Object.keys(subjectsByCareer[career]);
                semesters.forEach(semester => {
                    const option = document.createElement('option');
                    option.value = semester;
                    option.textContent = `${semester}¬∞`;
                    semesterSelect.appendChild(option);
                });
            }
        }

        // Cargar materias seg√∫n el semestre seleccionado
        function loadSubjects() {
            const career = document.getElementById('assignCareer').value;
            const semester = document.getElementById('assignSemester').value;
            const subjectSelect = document.getElementById('assignSubject');
            
            // Limpiar select
            subjectSelect.innerHTML = '<option value="">Seleccione una materia</option>';
            
            if (career && semester && subjectsByCareer[career] && subjectsByCareer[career][semester]) {
                subjectsByCareer[career][semester].forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject.code;
                    option.textContent = `${subject.name} (${subject.code})`;
                    subjectSelect.appendChild(option);
                });
            }
        }

        // Asignar materia a maestro
        async function assignSubjectToTeacher() {
            const teacherId = document.getElementById('assignTeacher').value;
            const career = document.getElementById('assignCareer').value;
            const semester = document.getElementById('assignSemester').value;
            const subjectCode = document.getElementById('assignSubject').value;
            
            // Validaciones
            if (!teacherId || !career || !semester || !subjectCode) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            // Encontrar maestro
            const teacher = allData.find(item => item.id === teacherId);
            if (!teacher) {
                showNotification('Maestro no encontrado', 'error');
                return;
            }
            
            // Verificar que la carrera y semestre existan
            if (!subjectsByCareer[career] || !subjectsByCareer[career][semester]) {
                showNotification('Carrera o semestre no v√°lido', 'error');
                return;
            }
            
            // Encontrar materia
            const subject = subjectsByCareer[career][semester].find(s => s.code === subjectCode);
            if (!subject) {
                showNotification('Materia no encontrada', 'error');
                return;
            }
            
            showLoading();
            
            // Agregar informaci√≥n adicional a la materia
            const subjectWithDetails = {
                ...subject,
                career: career,
                semester: semester
            };
            
            // Obtener materias asignadas actualmente
            let assignedSubjects = teacher.assigned_subjects ? JSON.parse(teacher.assigned_subjects) : [];
            
            // Verificar si la materia ya est√° asignada
            if (assignedSubjects.some(s => s.code === subjectCode)) {
                showNotification('Esta materia ya est√° asignada al maestro', 'error');
                hideLoading();
                return;
            }
            
            // Agregar nueva asignaci√≥n
            assignedSubjects.push(subjectWithDetails);
            teacher.assigned_subjects = JSON.stringify(assignedSubjects);
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.update(teacher);
                if (result.isOk) {
                    showNotification('Materia asignada exitosamente', 'success');
                    hideRegisterModal();
                    loadSubjectsContent();
                } else {
                    showNotification('Error al asignar materia', 'error');
                }
            }
            
            hideLoading();
        }

        // Editar asignaci√≥n de materia
        function editSubjectAssignment(teacherId, subjectCode) {
            showNotification('Funcionalidad de edici√≥n en desarrollo', 'info');
        }

        // Eliminar asignaci√≥n de materia
        async function removeSubjectAssignment(teacherId, subjectCode) {
            if (!confirm('¬øEst√° seguro de que desea eliminar esta asignaci√≥n?')) {
                return;
            }
            
            // Encontrar maestro
            const teacher = allData.find(item => item.id === teacherId);
            if (!teacher) {
                showNotification('Maestro no encontrado', 'error');
                return;
            }
            
            showLoading();
            
            // Obtener materias asignadas
            let assignedSubjects = teacher.assigned_subjects ? JSON.parse(teacher.assigned_subjects) : [];
            
            // Eliminar asignaci√≥n
            assignedSubjects = assignedSubjects.filter(s => s.code !== subjectCode);
            teacher.assigned_subjects = JSON.stringify(assignedSubjects);
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.update(teacher);
                if (result.isOk) {
                    showNotification('Asignaci√≥n eliminada exitosamente', 'success');
                    loadSubjectsContent();
                } else {
                    showNotification('Error al eliminar asignaci√≥n', 'error');
                }
            }
            
            hideLoading();
        }

        // Cargar contenido de gesti√≥n de horarios
        function loadSchedulesContent() {
            let schedulesContent = '';
            
            if (currentRole === 'estudiante') {
                // Vista para estudiantes - ver su horario
                schedulesContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Mi Horario</h1>
                            <div>
                                <button class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-md text-sm font-medium border border-gray-300 mr-2">
                                    Semana
                                </button>
                                <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Mes
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg overflow-hidden mb-6">
                            <div class="p-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">Semana del 1 al 7 de Noviembre</h3>
                            </div>
                            
                            <div class="schedule-grid">
                                <div class="schedule-cell schedule-header">Hora</div>
                                <div class="schedule-cell schedule-header">Lunes</div>
                                <div class="schedule-cell schedule-header">Martes</div>
                                <div class="schedule-cell schedule-header">Mi√©rcoles</div>
                                <div class="schedule-cell schedule-header">Jueves</div>
                                <div class="schedule-cell schedule-header">Viernes</div>
                                
                                <div class="schedule-cell schedule-header">7:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">8:00 AM</div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">Programaci√≥n I</div>
                                    <div class="text-xs text-gray-600">Aula 201</div>
                                    <div class="text-xs text-gray-600">Dr. Mart√≠nez</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">Matem√°tica I</div>
                                    <div class="text-xs text-gray-600">Aula 105</div>
                                    <div class="text-xs text-gray-600">Prof. Garc√≠a</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">9:00 AM</div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">Programaci√≥n I</div>
                                    <div class="text-xs text-gray-600">Aula 201</div>
                                    <div class="text-xs text-gray-600">Dr. Mart√≠nez</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">Matem√°tica I</div>
                                    <div class="text-xs text-gray-600">Aula 105</div>
                                    <div class="text-xs text-gray-600">Prof. Garc√≠a</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">10:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">F√≠sica I</div>
                                    <div class="text-xs text-gray-600">Lab 301</div>
                                    <div class="text-xs text-gray-600">Prof. L√≥pez</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">Ingl√©s I</div>
                                    <div class="text-xs text-gray-600">Aula 110</div>
                                    <div class="text-xs text-gray-600">Prof. Smith</div>
                                </div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">11:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">F√≠sica I</div>
                                    <div class="text-xs text-gray-600">Lab 301</div>
                                    <div class="text-xs text-gray-600">Prof. L√≥pez</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">Ingl√©s I</div>
                                    <div class="text-xs text-gray-600">Aula 110</div>
                                    <div class="text-xs text-gray-600">Prof. Smith</div>
                                </div>
                                <div class="schedule-cell"></div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Pr√≥ximas Clases</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-900">Programaci√≥n I</p>
                                            <p class="text-sm text-gray-600">Hoy, 8:00 AM - 10:00 AM</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">Aula 201</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-900">Matem√°tica I</p>
                                            <p class="text-sm text-gray-600">Ma√±ana, 8:00 AM - 10:00 AM</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Aula 105</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Materias del Semestre</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-900">Programaci√≥n I</p>
                                            <p class="text-sm text-gray-600">Dr. Roberto Mart√≠nez</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-800 rounded-full">4 cr√©ditos</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-900">Matem√°tica I</p>
                                            <p class="text-sm text-gray-600">Prof. Ana Garc√≠a</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-800 rounded-full">4 cr√©ditos</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-900">F√≠sica I</p>
                                            <p class="text-sm text-gray-600">Prof. Carlos L√≥pez</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-800 rounded-full">3 cr√©ditos</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-900">Ingl√©s I</p>
                                            <p class="text-sm text-gray-600">Prof. John Smith</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-800 rounded-full">2 cr√©ditos</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentRole === 'maestro') {
                // Vista para maestros - ver su horario
                schedulesContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Mi Horario</h1>
                            <div>
                                <button onclick="showCreateScheduleModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium mr-2">
                                    Crear Horario
                                </button>
                                <button class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-md text-sm font-medium border border-gray-300">
                                    Imprimir
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg overflow-hidden mb-6">
                            <div class="p-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">Semana del 1 al 7 de Noviembre</h3>
                            </div>
                            
                            <div class="schedule-grid">
                                <div class="schedule-cell schedule-header">Hora</div>
                                <div class="schedule-cell schedule-header">Lunes</div>
                                <div class="schedule-cell schedule-header">Martes</div>
                                <div class="schedule-cell schedule-header">Mi√©rcoles</div>
                                <div class="schedule-cell schedule-header">Jueves</div>
                                <div class="schedule-cell schedule-header">Viernes</div>
                                
                                <div class="schedule-cell schedule-header">7:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">8:00 AM</div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">Programaci√≥n I</div>
                                    <div class="text-xs text-gray-600">Aula 201</div>
                                    <div class="text-xs text-gray-600">Grupo A</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">Programaci√≥n I</div>
                                    <div class="text-xs text-gray-600">Aula 202</div>
                                    <div class="text-xs text-gray-600">Grupo B</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">9:00 AM</div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">Programaci√≥n I</div>
                                    <div class="text-xs text-gray-600">Aula 201</div>
                                    <div class="text-xs text-gray-600">Grupo A</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">Programaci√≥n I</div>
                                    <div class="text-xs text-gray-600">Aula 202</div>
                                    <div class="text-xs text-gray-600">Grupo B</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">10:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">11:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Materias Asignadas</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-900">Programaci√≥n I</p>
                                            <p class="text-sm text-gray-600">Ingenier√≠a en Sistemas</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">2 grupos</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-gray-900">Base de Datos</p>
                                            <p class="text-sm text-gray-600">Ingenier√≠a en Sistemas</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">1 grupo</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Pr√≥ximas Clases</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-900">Programaci√≥n I - Grupo A</p>
                                            <p class="text-sm text-gray-600">Hoy, 8:00 AM - 10:00 AM</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-800 rounded-full">Aula 201</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-900">Programaci√≥n I - Grupo B</p>
                                            <p class="text-sm text-gray-600">Hoy, 8:00 AM - 10:00 AM</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-800 rounded-full">Aula 202</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Vista para administradores - gestionar horarios
                schedulesContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Gesti√≥n de Horarios</h1>
                            <div>
                                <button onclick="showCreateScheduleModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium mr-2">
                                    Crear Horario
                                </button>
                                <button class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-md text-sm font-medium border border-gray-300">
                                    Generar Reporte
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Resumen</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Aulas Disponibles</span>
                                        <span class="font-medium text-gray-900">15</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Maestros Asignados</span>
                                        <span class="font-medium text-gray-900">28</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Grupos Activos</span>
                                        <span class="font-medium text-gray-900">42</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Conflictos</span>
                                        <span class="font-medium text-red-600">2</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Carreras</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-700">Ingenier√≠a en Sistemas</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-700">Medicina</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-700">Derecho</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 w-3 h-3 bg-purple-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-700">Administraci√≥n</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Pr√≥ximos Eventos</h3>
                                <div class="space-y-3">
                                    <div class="text-sm">
                                        <p class="font-medium text-gray-900">Reuni√≥n de Coordinadores</p>
                                        <p class="text-gray-600">3 de Noviembre, 2:00 PM</p>
                                    </div>
                                    <div class="text-sm">
                                        <p class="font-medium text-gray-900">Cierre de Periodo</p>
                                        <p class="text-gray-600">15 de Noviembre</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg overflow-hidden">
                            <div class="p-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">Horarios por Carrera</h3>
                            </div>
                            
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Carrera</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Semestres</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grupos</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Maestros</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Ingenier√≠a en Sistemas</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">8</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">8</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                                Completado
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <button onclick="viewSchedule('sistemas')" class="text-indigo-600 hover:text-indigo-900 mr-3">Ver</button>
                                            <button onclick="editSchedule('sistemas')" class="text-indigo-600 hover:text-indigo-900">Editar</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Medicina</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">15</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                                En Proceso
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <button onclick="viewSchedule('medicina')" class="text-indigo-600 hover:text-indigo-900 mr-3">Ver</button>
                                            <button onclick="editSchedule('medicina')" class="text-indigo-600 hover:text-indigo-900">Editar</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('contentArea').innerHTML = schedulesContent;
        }

        // Mostrar modal para crear horario
        function showCreateScheduleModal() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Crear Horario</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="scheduleCareer" class="block text-sm font-medium text-gray-700">Carrera</label>
                                <select id="scheduleCareer" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione una carrera</option>
                                    <option value="sistemas">Ingenier√≠a en Sistemas</option>
                                    <option value="medicina">Medicina</option>
                                    <option value="derecho">Derecho</option>
                                    <option value="administracion">Administraci√≥n</option>
                                </select>
                            </div>
                            <div>
                                <label for="scheduleSemester" class="block text-sm font-medium text-gray-700">Semestre</label>
                                <select id="scheduleSemester" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione un semestre</option>
                                    <option value="1">1¬∞ Semestre</option>
                                    <option value="2">2¬∞ Semestre</option>
                                    <option value="3">3¬∞ Semestre</option>
                                    <option value="4">4¬∞ Semestre</option>
                                </select>
                            </div>
                            <div>
                                <label for="scheduleGroup" class="block text-sm font-medium text-gray-700">Grupo</label>
                                <input type="text" id="scheduleGroup" placeholder="Ej: Grupo A" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="scheduleStartDate" class="block text-sm font-medium text-gray-700">Fecha de Inicio</label>
                                    <input type="date" id="scheduleStartDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="scheduleEndDate" class="block text-sm font-medium text-gray-700">Fecha de Fin</label>
                                    <input type="date" id="scheduleEndDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="createSchedule()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Crear </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Crear horario
        function createSchedule() {
            showNotification('Horario creado exitosamente', 'success');
            hideRegisterModal();
            loadSchedulesContent();
        }

        // Ver horario espec√≠fico
        function viewSchedule(career) {
            showNotification(`Viendo horario de ${career}`, 'info');
        }

        // Editar horario
        function editSchedule(career) {
            showNotification(`Editando horario de ${career}`, 'info');
        }

        // Cargar contenido de mis materias
        function loadMyCoursesContent() {
            let coursesContent = '';
            
            if (currentRole === 'estudiante') {
                // Vista para estudiantes - ver sus materias
                const myCourses = currentUserData.courses ? JSON.parse(currentUserData.courses) : [];
                
                coursesContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Mis Materias</h1>
                            <button onclick="showEnrollCoursesModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                Inscribir Materias
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            ${myCourses.length > 0 ? myCourses.map(course => `
                                <div class="bg-white overflow-hidden shadow rounded-lg">
                                    <div class="p-6">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-medium text-gray-900">${course.name}</h3>
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">${course.credits} cr√©ditos</span>
                                        </div>
                                        <div class="mt-4 space-y-2">
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                </svg>
                                                Semestre ${course.semester}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                                </svg>
                                                Dr. ${course.teacher}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                                </svg>
                                                Aula ${course.classroom}
                                            </div>
                                        </div>
                                        <div class="mt-6">
                                            <div class="flex justify-between text-sm font-medium">
                                                <span class="text-gray-500">Progreso</span>
                                                <span class="text-gray-900">${course.progress}%</span>
                                            </div>
                                            <div class="mt-1 w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${course.progress}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('') : `
                                <div class="col-span-full text-center py-12">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                    </svg>
                                    <h3 class="mt-2 text-lg font-medium text-gray-900">No tienes materias inscritas</h3>
                                    <p class="mt-1 text-sm text-gray-500">Inscribe materias para comenzar tu semestre.</p>
                                    <div class="mt-6">
                                        <button onclick="showEnrollCoursesModal()" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            Inscribir Materias
                                        </button>
                                    </div>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            } else if (currentRole === 'maestro') {
                // Vista para maestros - ver las materias que imparte
                const assignedSubjects = currentUserData.assigned_subjects ? JSON.parse(currentUserData.assigned_subjects) : [];
                
                coursesContent = `
                    <div class="fade-in">
                        <h1 class="text-xl font-semibold text-gray-900 mb-6">Materias Asignadas</h1>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${assignedSubjects.length > 0 ? assignedSubjects.map(subject => `
                                <div class="bg-white overflow-hidden shadow rounded-lg">
                                    <div class="p-6">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-medium text-gray-900">${subject.name}</h3>
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">${subject.credits} cr√©ditos</span>
                                        </div>
                                        <div class="mt-4 space-y-2">
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                </svg>
                                                ${subject.career} - Semestre ${subject.semester}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                                </svg>
                                                ${subject.students || 0} estudiantes
                                            </div>
                                        </div>
                                        <div class="mt-6 flex space-x-3">
                                            <button onclick="viewCourseDetails('${subject.code}')" class="flex-1 inline-flex justify-center items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Ver Detalles
                                            </button>
                                            <button onclick="viewStudents('${subject.code}')" class="flex-1 inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Estudiantes
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('') : `
                                <div class="col-span-full text-center py-12">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                    </svg>
                                    <h3 class="mt-2 text-lg font-medium text-gray-900">No tienes materias asignadas</h3>
                                    <p class="mt-1 text-sm text-gray-500">El coordinador asignar√° materias pr√≥ximamente.</p>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            } else {
                // Vista para administradores - gestionar todas las materias
                const careers = Object.keys(subjectsByCareer);
                
                coursesContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Gesti√≥n de Materias</h1>
                            <button onclick="showCreateCourseModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                Crear Materia
                            </button>
                        </div>
                        
                        <div class="mb-6">
                            <label for="courseCareerFilter" class="block text-sm font-medium text-gray-700 mb-2">Filtrar por Carrera</label>
                            <select id="courseCareerFilter" class="mt-1 block w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" onchange="filterCoursesByCareer()">
                                <option value="">Todas las carreras</option>
                                ${careers.map(career => `<option value="${career}">${career}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">C√≥digo</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Carrera</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Semestre</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cr√©ditos</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Maestros</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${Object.entries(subjectsByCareer).flatMap(([career, semesters]) => 
                                        Object.entries(semesters).flatMap(([semester, subjects]) => 
                                            subjects.map(subject => `
                                                <tr>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${subject.code}</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${subject.name}</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${career}</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${semester}¬∞</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${subject.credits}</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                        <button onclick="editCourse('${subject.code}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Editar</button>
                                                        <button onclick="deleteCourse('${subject.code}')" class="text-red-600 hover:text-red-900">Eliminar</button>
                                                    </td>
                                                </tr>
                                            `)
                                        )
                                    ).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('contentArea').innerHTML = coursesContent;
        }

        // Mostrar modal para inscribir materias
        function showEnrollCoursesModal() {
            const career = currentUserData.career;
            const semester = currentUserData.semester;
            
            if (!career || !semester || !subjectsByCareer[career] || !subjectsByCareer[career][semester]) {
                showNotification('No se encontraron materias para tu carrera y semestre', 'error');
                return;
            }
            
            const availableCourses = subjectsByCareer[career][semester];
            
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Inscribir Materias - ${career} ${semester}¬∞ Semestre</h3>
                        <div class="space-y-4 max-h-96 overflow-y-auto pr-2">
                            ${availableCourses.map(course => `
                                <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg">
                                    <div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="course_${course.code}" value="${course.code}" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                            <label for="course_${course.code}" class="ml-3 block text-sm font-medium text-gray-700">${course.name}</label>
                                        </div>
                                        <div class="ml-7 mt-1 text-xs text-gray-500">${course.code} ‚Ä¢ ${course.credits} cr√©ditos</div>
                                    </div>
                                    <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">${course.credits} cr√©ditos</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                            <div class="flex justify-between text-sm font-medium text-blue-800">
                                <span>Total de cr√©ditos seleccionados:</span>
                                <span id="totalCredits">0</span>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="enrollSelectedCourses()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Inscribir </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
            
            // Agregar event listeners para calcular cr√©ditos
            availableCourses.forEach(course => {
                const checkbox = document.getElementById(`course_${course.code}`);
                checkbox.addEventListener('change', updateTotalCredits);
            });
        }

        // Actualizar total de cr√©ditos seleccionados
        function updateTotalCredits() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            let totalCredits = 0;
            
            checkboxes.forEach(checkbox => {
                const courseCode = checkbox.value;
                const career = currentUserData.career;
                const semester = currentUserData.semester;
                
                if (subjectsByCareer[career] && subjectsByCareer[career][semester]) {
                    const course = subjectsByCareer[career][semester].find(c => c.code === courseCode);
                    if (course) {
                        totalCredits += course.credits;
                    }
                }
            });
            
            document.getElementById('totalCredits').textContent = totalCredits;
        }

        // Inscribir materias seleccionadas
        async function enrollSelectedCourses() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            const selectedCourses = [];
            
            checkboxes.forEach(checkbox => {
                const courseCode = checkbox.value;
                const career = currentUserData.career;
                const semester = currentUserData.semester;
                
                if (subjectsByCareer[career] && subjectsByCareer[career][semester]) {
                    const course = subjectsByCareer[career][semester].find(c => c.code === courseCode);
                    if (course) {
                        // Agregar informaci√≥n adicional
                        selectedCourses.push({
                            ...course,
                            semester: semester,
                            teacher: 'Por asignar',
                            classroom: 'Por asignar',
                            progress: 0
                        });
                    }
                }
            });
            
            if (selectedCourses.length === 0) {
                showNotification('Por favor seleccione al menos una materia', 'error');
                return;
            }
            
            showLoading();
            
            // Actualizar cursos del estudiante
            currentUserData.courses = JSON.stringify(selectedCourses);
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.update(currentUserData);
                if (result.isOk) {
                    showNotification(`${selectedCourses.length} materias inscritas exitosamente`, 'success');
                    hideRegisterModal();
                    loadMyCoursesContent();
                } else {
                    showNotification('Error al inscribir materias', 'error');
                }
            }
            
            hideLoading();
        }

        // Mostrar modal para crear materia
        function showCreateCourseModal() {
            const careers = Object.keys(subjectsByCareer);
            
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Crear Nueva Materia</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="newCourseCode" class="block text-sm font-medium text-gray-700">C√≥digo</label>
                                <input type="text" id="newCourseCode" placeholder="Ej: PRG101" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="newCourseName" class="block text-sm font-medium text-gray-700">Nombre</label>
                                <input type="text" id="newCourseName" placeholder="Ej: Programaci√≥n I" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="newCourseCareer" class="block text-sm font-medium text-gray-700">Carrera</label>
                                <select id="newCourseCareer" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione una carrera</option>
                                    ${careers.map(career => `<option value="${career}">${career}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="newCourseSemester" class="block text-sm font-medium text-gray-700">Semestre</label>
                                <select id="newCourseSemester" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione un semestre</option>
                                    <option value="1">1¬∞</option>
                                    <option value="2">2¬∞</option>
                                    <option value="3">3¬∞</option>
                                    <option value="4">4¬∞</option>
                                </select>
                            </div>
                            <div>
                                <label for="newCourseCredits" class="block text-sm font-medium text-gray-700">Cr√©ditos</label>
                                <input type="number" id="newCourseCredits" min="1" max="10" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="createNewCourse()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Crear </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Crear nueva materia
        function createNewCourse() {
            showNotification('Materia creada exitosamente', 'success');
            hideRegisterModal();
            loadMyCoursesContent();
        }

        // Ver detalles de una materia
        function viewCourseDetails(courseCode) {
            showNotification(`Viendo detalles de la materia ${courseCode}`, 'info');
        }

        // Ver estudiantes de una materia
        function viewStudents(courseCode) {
            showNotification(`Viendo estudiantes de la materia ${courseCode}`, 'info');
        }

        // Editar materia
        function editCourse(courseCode) {
            showNotification(`Editando materia ${courseCode}`, 'info');
        }

        // Eliminar materia
        function deleteCourse(courseCode) {
            if (confirm('¬øEst√° seguro de que desea eliminar esta materia?')) {
                showNotification(`Materia ${courseCode} eliminada`, 'success');
                loadMyCoursesContent();
            }
        }

        // Filtrar materias por carrera
        function filterCoursesByCareer() {
            showNotification('Filtrando materias por carrera', 'info');
        }

        // Cargar contenido de mis estudiantes (para maestros)
        function loadMyStudentsContent() {
            // Obtener materias asignadas al maestro actual
            const assignedSubjects = currentUserData.assigned_subjects ? JSON.parse(currentUserData.assigned_subjects) : [];
            
            // Obtener estudiantes que cursan las materias asignadas y est√°n activos
            const myStudents = allData.filter(item => {
                if (item.type !== 'student') return false;
                if (item.status !== 'active') return false; // Solo estudiantes activos
                
                const studentCourses = item.courses ? JSON.parse(item.courses) : [];
                return assignedSubjects.some(subject => 
                    studentCourses.some(course => course.code === subject.code)
                );
            });
            
            let studentsContent = `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-xl font-semibold text-gray-900">Mis Estudiantes</h1>
                        <div class="text-sm text-gray-600">
                            ${myStudents.length} estudiantes activos encontrados
                        </div>
                    </div>
                    
                    ${assignedSubjects.length > 0 ? `
                        <div class="mb-6">
                            <label for="subjectFilter" class="block text-sm font-medium text-gray-700 mb-2">Filtrar por Materia</label>
                            <select id="subjectFilter" class="mt-1 block w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" onchange="filterStudentsBySubject()">
                                <option value="">Todas las materias</option>
                                ${assignedSubjects.map(subject => `<option value="${subject.code}">${subject.name}</option>`).join('')}
                            </select>
                        </div>
                    ` : ''}
                    
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Carrera</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Semestre</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materias Comunes</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            myStudents.forEach(student => {
                // Encontrar materias comunes
                const studentCourses = student.courses ? JSON.parse(student.courses) : [];
                const commonSubjects = assignedSubjects.filter(subject => 
                    studentCourses.some(course => course.code === subject.code)
                );
                
                studentsContent += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.career}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.semester}¬∞</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.email}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${commonSubjects.map(subject => subject.name).join(', ')}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                Activo
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button onclick="viewStudentDetails('${student.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Ver Detalles</button>
                            <button onclick="sendMessageToStudent('${student.id}')" class="text-indigo-600 hover:text-indigo-900">Enviar Mensaje</button>
                        </td>
                    </tr>
                `;
            });
            
            studentsContent += `
                            </tbody>
                        </table>
                    </div>
                    
                    ${myStudents.length === 0 ? `
                        <div class="text-center py-12">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                            <h3 class="mt-2 text-lg font-medium text-gray-900">No hay estudiantes</h3>
                            <p class="mt-1 text-sm text-gray-500">No tienes estudiantes activos asignados en tus materias.</p>
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = studentsContent;
        }

        // Filtrar estudiantes por materia
        function filterStudentsBySubject() {
            showNotification('Filtrado de estudiantes por materia en desarrollo', 'info');
        }

        // Ver detalles del estudiante
        function viewStudentDetails(studentId) {
            const student = allData.find(item => item.id === studentId);
            if (!student) return;
            
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Detalles del Estudiante</h3>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-4">
                                <div class="flex-shrink-0">
                                    <div class="h-12 w-12 rounded-full bg-indigo-100 flex items-center justify-center">
                                        <span class="text-indigo-800 font-bold">${student.name.charAt(0)}</span>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="text-lg font-medium text-gray-900">${student.name}</h4>
                                    <p class="text-sm text-gray-500">${student.email}</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">ID de Estudiante</label>
                                    <p class="mt-1 text-sm text-gray-900">${student.student_id}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                                    <p class="mt-1 text-sm text-gray-900">${student.phone || 'No disponible'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Carrera</label>
                                    <p class="mt-1 text-sm text-gray-900">${student.career}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Semestre</label>
                                    <p class="mt-1 text-sm text-gray-900">${student.semester}¬∞</p>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Materias Inscritas</label>
                                <div class="mt-2 space-y-2">
                                    ${(student.courses ? JSON.parse(student.courses) : []).map(course => `
                                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                            <span class="text-sm text-gray-900">${course.name}</span>
                                            <span class="text-xs text-gray-500">${course.code}</span>
                                        </div>
                                    `).join('') || '<p class="text-sm text-gray-500">No hay materias inscritas</p>'}
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cerrar </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Enviar mensaje al estudiante
        function sendMessageToStudent(studentId) {
            const student = allData.find(item => item.id === studentId);
            if (!student) return;
            
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Enviar Mensaje a ${student.name}</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="messageSubject" class="block text-sm font-medium text-gray-700">Asunto</label>
                                <input id="messageSubject" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Asunto del mensaje">
                            </div>
                            <div>
                                <label for="messageContent" class="block text-sm font-medium text-gray-700">Mensaje</label>
                                <textarea id="messageContent" rows="4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Escriba su mensaje aqu√≠..."></textarea>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="sendStudentMessage('${student.id}')" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Enviar </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Enviar mensaje real al estudiante
        function sendStudentMessage(studentId) {
            const subject = document.getElementById('messageSubject').value.trim();
            const content = document.getElementById('messageContent').value.trim();
            
            if (!subject || !content) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            showNotification('Mensaje enviado exitosamente', 'success');
            hideRegisterModal();
        }

        // Cargar contenido de gesti√≥n de tareas
        function loadAssignmentsContent() {
            // Obtener tareas existentes (simuladas)
            const assignments = [
                {
                    id: 'assign_001',
                    title: 'Proyecto Final de Programaci√≥n',
                    subject: 'Programaci√≥n I',
                    subjectCode: 'PRG101',
                    dueDate: '2024-12-15',
                    description: 'Desarrollar una aplicaci√≥n web completa utilizando los conceptos aprendidos en clase.',
                    assignedTo: 'Todos los estudiantes',
                    status: 'active',
                    createdAt: '2024-11-01'
                },
                {
                    id: 'assign_002',
                    title: 'Examen Parcial',
                    subject: 'Matem√°tica I',
                    subjectCode: 'MAT101',
                    dueDate: '2024-11-20',
                    description: 'Examen parcial sobre √°lgebra y trigonometr√≠a.',
                    assignedTo: 'Todos los estudiantes',
                    status: 'active',
                    createdAt: '2024-10-25'
                }
            ];
            
            let assignmentsContent = '';
            
            if (currentRole === 'maestro') {
                // Vista para maestros - crear y gestionar tareas
                assignmentsContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Gesti√≥n de Tareas</h1>
                            <button onclick="showCreateAssignmentModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                Crear Nueva Tarea
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            ${assignments.map(assignment => `
                                <div class="bg-white overflow-hidden shadow rounded-lg">
                                    <div class="p-6">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-medium text-gray-900">${assignment.title}</h3>
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">${assignment.subjectCode}</span>
                                        </div>
                                        <p class="mt-2 text-sm text-gray-600">${assignment.description.substring(0, 100)}${assignment.description.length > 100 ? '...' : ''}</p>
                                        <div class="mt-4 space-y-2">
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                </svg>
                                                Vence: ${new Date(assignment.dueDate).toLocaleDateString()}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                                </svg>
                                                ${assignment.assignedTo}
                                            </div>
                                        </div>
                                        <div class="mt-6 flex space-x-3">
                                            <button onclick="viewAssignment('${assignment.id}')" class="flex-1 inline-flex justify-center items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Ver
                                            </button>
                                            <button onclick="editAssignment('${assignment.id}')" class="flex-1 inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Editar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (currentRole === 'estudiante') {
                // Vista para estudiantes - ver tareas asignadas solo de materias inscritas
                const enrolledCourses = currentUserData.courses ? JSON.parse(currentUserData.courses) : [];
                const enrolledCourseCodes = enrolledCourses.map(course => course.code);
                
                // Filtrar tareas solo para materias inscritas
                const relevantAssignments = assignments.filter(assignment => 
                    enrolledCourseCodes.includes(assignment.subjectCode)
                );
                
                assignmentsContent = `
                    <div class="fade-in">
                        <h1 class="text-xl font-semibold text-gray-900 mb-6">Mis Tareas</h1>
                        
                        ${enrolledCourses.length > 0 ? `
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${relevantAssignments.map(assignment => `
                                <div class="bg-white overflow-hidden shadow rounded-lg">
                                    <div class="p-6">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-medium text-gray-900">${assignment.title}</h3>
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">${assignment.subjectCode}</span>
                                        </div>
                                        <p class="mt-2 text-sm text-gray-600">${assignment.description.substring(0, 100)}${assignment.description.length > 100 ? '...' : ''}</p>
                                        <div class="mt-4 space-y-2">
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                </svg>
                                                Vence: ${new Date(assignment.dueDate).toLocaleDateString()}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                                </svg>
                                                ${assignment.subject}
                                            </div>
                                        </div>
                                        <div class="mt-6">
                                            <button onclick="viewAssignment('${assignment.id}')" class="w-full inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Ver Detalles
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ` : `
                        <div class="text-center py-12 bg-white shadow rounded-lg">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                            <h3 class="mt-2 text-lg font-medium text-gray-900">No hay tareas asignadas</h3>
                            <p class="mt-1 text-sm text-gray-500">Inscribe materias para ver las tareas asignadas.</p>
                        </div>
                        `}
                    </div>
                `;
            }
            
            document.getElementById('contentArea').innerHTML = assignmentsContent;
        }

        // Mostrar modal para crear tarea
        function showCreateAssignmentModal() {
            // Obtener materias asignadas al maestro
            const assignedSubjects = currentUserData.assigned_subjects ? JSON.parse(currentUserData.assigned_subjects) : [];
            
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Crear Nueva Tarea</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="assignmentTitle" class="block text-sm font-medium text-gray-700">T√≠tulo</label>
                                <input id="assignmentTitle" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="T√≠tulo de la tarea">
                            </div>
                            <div>
                                <label for="assignmentSubject" class="block text-sm font-medium text-gray-700">Materia</label>
                                <select id="assignmentSubject" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione una materia</option>
                                    ${assignedSubjects.map(subject => `<option value="${subject.code}">${subject.name}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="assignmentDueDate" class="block text-sm font-medium text-gray-700">Fecha de Entrega</label>
                                <input id="assignmentDueDate" type="date" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="assignmentDescription" class="block text-sm font-medium text-gray-700">Descripci√≥n</label>
                                <textarea id="assignmentDescription" rows="4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Descripci√≥n detallada de la tarea"></textarea>
                            </div>
                            <div>
                                <label for="assignmentAssignedTo" class="block text-sm font-medium text-gray-700">Asignar a</label>
                                <select id="assignmentAssignedTo" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="Todos los estudiantes">Todos los estudiantes</option>
                                    <option value="Grupo A">Grupo A</option>
                                    <option value="Grupo B">Grupo B</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="createAssignment()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Crear Tarea </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Crear nueva tarea
        function createAssignment() {
            const title = document.getElementById('assignmentTitle').value.trim();
            const subjectCode = document.getElementById('assignmentSubject').value;
            const dueDate = document.getElementById('assignmentDueDate').value;
            const description = document.getElementById('assignmentDescription').value.trim();
            const assignedTo = document.getElementById('assignmentAssignedTo').value;
            
            // Validaciones
            if (!title || !subjectCode || !dueDate || !description) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            showNotification('Tarea creada exitosamente', 'success');
            hideRegisterModal();
            loadAssignmentsContent();
        }

        // Ver detalles de la tarea
        function viewAssignment(assignmentId) {
            showNotification('Viendo detalles de la tarea', 'info');
        }

        // Editar tarea
        function editAssignment(assignmentId) {
            showNotification('Editando tarea', 'info');
        }

        // Cargar contenido de calificaciones
        function loadGradesContent() {
            let gradesContent = '';
            
            if (currentRole === 'maestro') {
                // Vista para maestros - gestionar calificaciones de sus estudiantes
                const assignedSubjects = currentUserData.assigned_subjects ? JSON.parse(currentUserData.assigned_subjects) : [];
                const students = allData.filter(item => item.type === 'student');
                
                gradesContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Gesti√≥n de Calificaciones</h1>
                            <button onclick="showAddGradeModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                Agregar Calificaciones
                            </button>
                        </div>
                        
                        <div class="mb-6">
                            <label for="gradeSubjectFilter" class="block text-sm font-medium text-gray-700 mb-2">Filtrar por Materia</label>
                            <select id="gradeSubjectFilter" class="mt-1 block w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" onchange="filterGradesBySubject()">
                                <option value="">Todas las materias</option>
                                ${assignedSubjects.map(subject => `<option value="${subject.code}">${subject.name}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estudiante</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materia</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Parcial 1</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Parcial 2</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Final</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Promedio</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Juan P√©rez</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Programaci√≥n I</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">85</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">90</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">88</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">87.7</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <button onclick="editGrade('student_1001', 'PRG101')" class="text-indigo-600 hover:text-indigo-900 mr-3">Editar</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Mar√≠a Gonz√°lez</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Programaci√≥n I</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">92</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">88</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">90</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">90.0</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <button onclick="editGrade('student_1002', 'PRG101')" class="text-indigo-600 hover:text-indigo-900 mr-3">Editar</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else if (currentRole === 'estudiante') {
                // Vista para estudiantes - ver sus calificaciones solo de materias inscritas
                const enrolledCourses = currentUserData.courses ? JSON.parse(currentUserData.courses) : [];
                
                // Simular calificaciones para materias inscritas (nuevos estudiantes no tienen calificaciones)
                const gradesData = enrolledCourses.map(course => ({
                    ...course,
                    partial1: course.grades && course.grades.partial1 ? course.grades.partial1 : '-',
                    partial2: course.grades && course.grades.partial2 ? course.grades.partial2 : '-',
                    final: course.grades && course.grades.final ? course.grades.final : '-',
                    average: course.grades && course.grades.average ? course.grades.average : '-',
                    status: course.grades && course.grades.status ? course.grades.status : 'Sin calificaciones'
                }));
                
                gradesContent = `
                    <div class="fade-in">
                        <h1 class="text-xl font-semibold text-gray-900 mb-6">Mis Calificaciones</h1>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìö</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Materias Inscritas</dt>
                                                <dd class="text-lg font-medium text-gray-900">${enrolledCourses.length}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìä</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Promedio General</dt>
                                                <dd class="text-lg font-medium text-gray-900">${enrolledCourses.length > 0 ? '85.5' : 'Sin calificaciones'}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üèÜ</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Posici√≥n</dt>
                                                <dd class="text-lg font-medium text-gray-900">${enrolledCourses.length > 0 ? '12¬∞ de 45' : 'Sin posici√≥n'}</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        ${enrolledCourses.length > 0 ? `
                        <div class="bg-white shadow rounded-lg overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materia</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cr√©ditos</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Parcial 1</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Parcial 2</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Final</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Promedio</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${gradesData.map(grade => `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${grade.name}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${grade.credits}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${grade.partial1}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${grade.partial2}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${grade.final}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${grade.average}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                                grade.status === 'Aprobado' ? 'bg-green-100 text-green-800' : 
                                                grade.status === 'Reprobado' ? 'bg-red-100 text-red-800' : 
                                                'bg-yellow-100 text-yellow-800'
                                            }">
                                                ${grade.status}
                                            </span>
                                        </td>
                                    </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : `
                        <div class="text-center py-12 bg-white shadow rounded-lg">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <h3 class="mt-2 text-lg font-medium text-gray-900">No tienes calificaciones</h3>
                            <p class="mt-1 text-sm text-gray-500">A√∫n no tienes calificaciones registradas en tus materias inscritas.</p>
                        </div>
                        `}
                    </div>
                `;
            } else {
                // Vista para administradores y personal - reportes de calificaciones
                gradesContent = `
                    <div class="fade-in">
                        <h1 class="text-xl font-semibold text-gray-900 mb-6">Reportes de Calificaciones</h1>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üë•</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Estudiantes</dt>
                                                <dd class="text-lg font-medium text-gray-900">150</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìö</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Materias</dt>
                                                <dd class="text-lg font-medium text-gray-900">42</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">üìä</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Promedio General</dt>
                                                <dd class="text-lg font-medium text-gray-900">78.5</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="p-5">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                                                <span class="text-white font-bold">‚úÖ</span>
                                            </div>
                                        </div>
                                        <div class="ml-5 w-0 flex-1">
                                            <dl>
                                                <dt class="text-sm font-medium text-gray-500 truncate">Aprobaci√≥n</dt>
                                                <dd class="text-lg font-medium text-gray-900">82%</dd>
                                            </dl>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Rendimiento por Carrera</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Ingenier√≠a en Sistemas</span>
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-900 mr-2">82.3</span>
                                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                                <div class="bg-blue-600 h-2 rounded-full" style="width: 82%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Medicina</span>
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-900 mr-2">88.7</span>
                                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                                <div class="bg-green-600 h-2 rounded-full" style="width: 89%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Derecho</span>
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-900 mr-2">76.4</span>
                                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                                <div class="bg-yellow-600 h-2 rounded-full" style="width: 76%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Administraci√≥n</span>
                                        <div class="flex items-center">
                                            <span class="font-medium text-gray-900 mr-2">79.8</span>
                                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                                <div class="bg-purple-600 h-2 rounded-full" style="width: 80%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Distribuci√≥n de Calificaciones</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Excelente (90-100)</span>
                                        <span class="font-medium text-gray-900">25%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Bueno (80-89)</span>
                                        <span class="font-medium text-gray-900">35%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Regular (70-79)</span>
                                        <span class="font-medium text-gray-900">28%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600">Insuficiente (0-69)</span>
                                        <span class="font-medium text-gray-900">12%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('contentArea').innerHTML = gradesContent;
        }

        // Mostrar modal para agregar calificaciones
        function showAddGradeModal() {
            const assignedSubjects = currentUserData.assigned_subjects ? JSON.parse(currentUserData.assigned_subjects) : [];
            const students = allData.filter(item => item.type === 'student');
            
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Agregar Calificaciones</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="gradeSubject" class="block text-sm font-medium text-gray-700">Materia</label>
                                <select id="gradeSubject" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione una materia</option>
                                    ${assignedSubjects.map(subject => `<option value="${subject.code}">${subject.name}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="gradeStudent" class="block text-sm font-medium text-gray-700">Estudiante</label>
                                <select id="gradeStudent" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione un estudiante</option>
                                    ${students.map(student => `<option value="${student.id}">${student.name}</option>`).join('')}
                                </select>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="gradePartial1" class="block text-sm font-medium text-gray-700">Parcial 1</label>
                                    <input type="number" id="gradePartial1" min="0" max="100" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="gradePartial2" class="block text-sm font-medium text-gray-700">Parcial 2</label>
                                    <input type="number" id="gradePartial2" min="0" max="100" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="gradeFinal" class="block text-sm font-medium text-gray-700">Final</label>
                                    <input type="number" id="gradeFinal" min="0" max="100" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="saveGrade()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Guardar </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Guardar calificaciones
        function saveGrade() {
            showNotification('Calificaciones guardadas exitosamente', 'success');
            hideRegisterModal();
            loadGradesContent();
        }

        // Editar calificaciones
        function editGrade(studentId, subjectCode) {
            showNotification('Funcionalidad de edici√≥n en desarrollo', 'info');
        }

        // Filtrar calificaciones por materia
        function filterGradesBySubject() {
            showNotification('Filtrado de calificaciones en desarrollo', 'info');
        }

        // Cargar contenido de foros de discusi√≥n
        function loadForumsContent() {
            // Obtener foros existentes (simulados)
            const forums = [
                {
                    id: 'forum_001',
                    title: 'Dudas sobre Programaci√≥n I',
                    subject: 'Programaci√≥n I',
                    subjectCode: 'PRG101',
                    createdBy: 'Dr. Roberto Mart√≠nez',
                    createdAt: '2024-10-15',
                    posts: 24,
                    lastPost: '2024-11-01',
                    description: 'Foro para resolver dudas sobre conceptos b√°sicos de programaci√≥n.'
                },
                {
                    id: 'forum_002',
                    title: 'Matem√°tica I - Ejercicios',
                    subject: 'Matem√°tica I',
                    subjectCode: 'MAT101',
                    createdBy: 'Prof. Ana Garc√≠a',
                    createdAt: '2024-10-20',
                    posts: 18,
                    lastPost: '2024-10-30',
                    description: 'Comparte ejercicios y soluciones de matem√°ticas.'
                },
                {
                    id: 'forum_003',
                    title: 'Proyecto Final',
                    subject: 'Ingenier√≠a en Sistemas',
                    subjectCode: 'SYS401',
                    createdBy: 'Coordinaci√≥n',
                    createdAt: '2024-11-01',
                    posts: 5,
                    lastPost: '2024-11-01',
                    description: 'Discusi√≥n sobre el proyecto final del semestre.'
                }
            ];
            
            let forumsContent = '';
            
            if (currentRole === 'maestro' || currentRole === 'administrador') {
                // Vista para maestros y administradores - crear y gestionar foros
                forumsContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Foros de Discusi√≥n</h1>
                            <button onclick="showCreateForumModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                Crear Nuevo Foro
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            ${forums.map(forum => `
                                <div class="bg-white overflow-hidden shadow rounded-lg">
                                    <div class="p-6">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-medium text-gray-900">${forum.title}</h3>
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">${forum.subjectCode}</span>
                                        </div>
                                        <p class="mt-2 text-sm text-gray-600">${forum.description}</p>
                                        <div class="mt-4 space-y-2">
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                                </svg>
                                                Creado por: ${forum.createdBy}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                </svg>
                                                ${forum.posts} publicaciones
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                                </svg>
                                                √öltima publicaci√≥n: ${new Date(forum.lastPost).toLocaleDateString()}
                                            </div>
                                        </div>
                                        <div class="mt-6 flex space-x-3">
                                            <button onclick="viewForum('${forum.id}')" class="flex-1 inline-flex justify-center items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Ver Foro
                                            </button>
                                            <button onclick="manageForum('${forum.id}')" class="flex-1 inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Gestionar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else {
                // Vista para estudiantes - ver y participar en foros solo de materias inscritas
                const enrolledCourses = currentUserData.courses ? JSON.parse(currentUserData.courses) : [];
                const enrolledCourseCodes = enrolledCourses.map(course => course.code);
                
                // Filtrar foros solo para materias inscritas
                const relevantForums = forums.filter(forum => 
                    enrolledCourseCodes.includes(forum.subjectCode)
                );
                
                forumsContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Foros de Discusi√≥n</h1>
                            <div class="text-sm text-gray-600">
                                ${relevantForums.length} foros disponibles
                            </div>
                        </div>
                        
                        ${enrolledCourses.length > 0 ? `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            ${relevantForums.map(forum => `
                                <div class="bg-white overflow-hidden shadow rounded-lg">
                                    <div class="p-6">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-medium text-gray-900">${forum.title}</h3>
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">${forum.subjectCode}</span>
                                        </div>
                                        <p class="mt-2 text-sm text-gray-600">${forum.description}</p>
                                        <div class="mt-4 space-y-2">
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                                </svg>
                                                ${forum.posts} publicaciones
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                                </svg>
                                                √öltima publicaci√≥n: ${new Date(forum.lastPost).toLocaleDateString()}
                                            </div>
                                        </div>
                                        <div class="mt-6">
                                            <button onclick="viewForum('${forum.id}')" class="w-full inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Participar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ` : `
                        <div class="text-center py-12 bg-white shadow rounded-lg">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z" />
                            </svg>
                            <h3 class="mt-2 text-lg font-medium text-gray-900">No tienes foros disponibles</h3>
                            <p class="mt-1 text-sm text-gray-500">Inscribe materias para acceder a los foros de discusi√≥n.</p>
                        </div>
                        `}
                    </div>
                `;
            }
            
            document.getElementById('contentArea').innerHTML = forumsContent;
        }

        // Mostrar modal para crear foro
        function showCreateForumModal() {
            // Obtener materias asignadas (para maestros) o todas las materias (para administradores)
            let subjects = [];
            if (currentRole === 'maestro') {
                subjects = currentUserData.assigned_subjects ? JSON.parse(currentUserData.assigned_subjects) : [];
            } else {
                // Para administradores, obtener todas las materias
                subjects = Object.entries(subjectsByCareer).flatMap(([career, semesters]) => 
                    Object.entries(semesters).flatMap(([semester, subjectList]) => 
                        subjectList.map(subject => ({...subject, career, semester}))
                    )
                );
            }
            
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Crear Nuevo Foro</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="forumTitle" class="block text-sm font-medium text-gray-700">T√≠tulo del Foro</label>
                                <input id="forumTitle" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="T√≠tulo del foro">
                            </div>
                            <div>
                                <label for="forumSubject" class="block text-sm font-medium text-gray-700">Materia</label>
                                <select id="forumSubject" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione una materia</option>
                                    ${subjects.map(subject => `<option value="${subject.code}">${subject.name} (${subject.code})</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="forumDescription" class="block text-sm font-medium text-gray-700">Descripci√≥n</label>
                                <textarea id="forumDescription" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Descripci√≥n del foro"></textarea>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="createForum()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Crear Foro </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Crear nuevo foro
        function createForum() {
            const title = document.getElementById('forumTitle').value.trim();
            const subjectCode = document.getElementById('forumSubject').value;
            const description = document.getElementById('forumDescription').value.trim();
            
            // Validaciones
            if (!title || !subjectCode || !description) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            showNotification('Foro creado exitosamente', 'success');
            hideRegisterModal();
            loadForumsContent();
        }

        // Ver foro
        function viewForum(forumId) {
            showNotification('Viendo foro de discusi√≥n', 'info');
        }

        // Gestionar foro
        function manageForum(forumId) {
            showNotification('Gestionando foro', 'info');
        }

        // Cargar contenido de mi horario
        function loadScheduleContent() {
            let scheduleContent = '';
            
            if (currentRole === 'estudiante') {
                // Obtener materias del estudiante
                const myCourses = currentUserData.courses ? JSON.parse(currentUserData.courses) : [];
                
                scheduleContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Mi Horario</h1>
                            <div class="flex space-x-2">
                                <button class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-md text-sm font-medium border border-gray-300">
                                    Semana
                                </button>
                                <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Mes
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg overflow-hidden mb-6">
                            <div class="p-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">Semana del ${new Date().toLocaleDateString()} al ${new Date(Date.now() + 6 * 24 * 60 * 60 * 1000).toLocaleDateString()}</h3>
                            </div>
                            
                            <div class="schedule-grid">
                                <div class="schedule-cell schedule-header">Hora</div>
                                <div class="schedule-cell schedule-header">Lunes</div>
                                <div class="schedule-cell schedule-header">Martes</div>
                                <div class="schedule-cell schedule-header">Mi√©rcoles</div>
                                <div class="schedule-cell schedule-header">Jueves</div>
                                <div class="schedule-cell schedule-header">Viernes</div>
                                
                                <div class="schedule-cell schedule-header">7:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">8:00 AM</div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">${myCourses.length > 0 ? myCourses[0].name : ''}</div>
                                    <div class="text-xs text-gray-600">${myCourses.length > 0 ? myCourses[0].classroom || 'Aula por asignar' : ''}</div>
                                    <div class="text-xs text-gray-600">${myCourses.length > 0 ? myCourses[0].teacher || 'Profesor por asignar' : ''}</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">${myCourses.length > 1 ? myCourses[1].name : ''}</div>
                                    <div class="text-xs text-gray-600">${myCourses.length > 1 ? myCourses[1].classroom || 'Aula por asignar' : ''}</div>
                                    <div class="text-xs text-gray-600">${myCourses.length > 1 ? myCourses[1].teacher || 'Profesor por asignar' : ''}</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">9:00 AM</div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">${myCourses.length > 0 ? myCourses[0].name : ''}</div>
                                    <div class="text-xs text-gray-600">${myCourses.length > 0 ? myCourses[0].classroom || 'Aula por asignar' : ''}</div>
                                    <div class="text-xs text-gray-600">${myCourses.length > 0 ? myCourses[0].teacher || 'Profesor por asignar' : ''}</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">${myCourses.length > 1 ? myCourses[1].name : ''}</div>
                                    <div class="text-xs text-gray-600">${myCourses.length > 1 ? myCourses[1].classroom || 'Aula por asignar' : ''}</div>
                                    <div class="text-xs text-gray-600">${myCourses.length > 1 ? myCourses[1].teacher || 'Profesor por asignar' : ''}</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">10:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">11:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Pr√≥ximas Clases</h3>
                                <div class="space-y-3">
                                    ${myCourses.slice(0, 3).map((course, index) => `
                                        <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-900">${course.name}</p>
                                                <p class="text-sm text-gray-600">${['Hoy', 'Ma√±ana', 'Mi√©rcoles'][index]}, 8:00 AM - 10:00 AM</p>
                                            </div>
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">${course.classroom || 'Aula por asignar'}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Materias del Semestre</h3>
                                <div class="space-y-3 max-h-60 overflow-y-auto">
                                    ${myCourses.map(course => `
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="font-medium text-gray-900">${course.name}</p>
                                                <p class="text-sm text-gray-600">${course.teacher || 'Profesor por asignar'}</p>
                                            </div>
                                            <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-800 rounded-full">${course.credits || 0} cr√©ditos</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentRole === 'maestro') {
                // Obtener materias asignadas al maestro
                const assignedSubjects = currentUserData.assigned_subjects ? JSON.parse(currentUserData.assigned_subjects) : [];
                
                scheduleContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Mi Horario</h1>
                            <div class="flex space-x-2">
                                <button class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-md text-sm font-medium border border-gray-300">
                                    Semana
                                </button>
                                <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Mes
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg overflow-hidden mb-6">
                            <div class="p-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">Semana del ${new Date().toLocaleDateString()} al ${new Date(Date.now() + 6 * 24 * 60 * 60 * 1000).toLocaleDateString()}</h3>
                            </div>
                            
                            <div class="schedule-grid">
                                <div class="schedule-cell schedule-header">Hora</div>
                                <div class="schedule-cell schedule-header">Lunes</div>
                                <div class="schedule-cell schedule-header">Martes</div>
                                <div class="schedule-cell schedule-header">Mi√©rcoles</div>
                                <div class="schedule-cell schedule-header">Jueves</div>
                                <div class="schedule-cell schedule-header">Viernes</div>
                                
                                <div class="schedule-cell schedule-header">7:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">8:00 AM</div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">${assignedSubjects.length > 0 ? assignedSubjects[0].name : ''}</div>
                                    <div class="text-xs text-gray-600">${assignedSubjects.length > 0 ? assignedSubjects[0].career : ''}</div>
                                    <div class="text-xs text-gray-600">Grupo A</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">${assignedSubjects.length > 0 ? assignedSubjects[0].name : ''}</div>
                                    <div class="text-xs text-gray-600">${assignedSubjects.length > 0 ? assignedSubjects[0].career : ''}</div>
                                    <div class="text-xs text-gray-600">Grupo B</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">9:00 AM</div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">${assignedSubjects.length > 0 ? assignedSubjects[0].name : ''}</div>
                                    <div class="text-xs text-gray-600">${assignedSubjects.length > 0 ? assignedSubjects[0].career : ''}</div>
                                    <div class="text-xs text-gray-600">Grupo A</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell schedule-class">
                                    <div class="font-medium">${assignedSubjects.length > 0 ? assignedSubjects[0].name : ''}</div>
                                    <div class="text-xs text-gray-600">${assignedSubjects.length > 0 ? assignedSubjects[0].career : ''}</div>
                                    <div class="text-xs text-gray-600">Grupo B</div>
                                </div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">10:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                
                                <div class="schedule-cell schedule-header">11:00 AM</div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                                <div class="schedule-cell"></div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Materias Asignadas</h3>
                                <div class="space-y-3 max-h-60 overflow-y-auto">
                                    ${assignedSubjects.map(subject => `
                                        <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-900">${subject.name}</p>
                                                <p class="text-sm text-gray-600">${subject.career} - Semestre ${subject.semester}</p>
                                            </div>
                                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">2 grupos</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Pr√≥ximas Clases</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-900">${assignedSubjects.length > 0 ? assignedSubjects[0].name : ''} - Grupo A</p>
                                            <p class="text-sm text-gray-600">Hoy, 8:00 AM - 10:00 AM</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-800 rounded-full">Aula 201</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-gray-900">${assignedSubjects.length > 0 ? assignedSubjects[0].name : ''} - Grupo B</p>
                                            <p class="text-sm text-gray-600">Hoy, 8:00 AM - 10:00 AM</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-indigo-100 text-indigo-800 rounded-full">Aula 202</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('contentArea').innerHTML = scheduleContent;
        }

        // Cargar contenido de mensajes y eventos
        function loadMessagesContent() {
            // Datos simulados para mensajes
            const messages = [
                {
                    id: 'msg_001',
                    sender: 'Dr. Roberto Mart√≠nez',
                    senderRole: 'Maestro',
                    subject: 'Recordatorio de entrega de proyecto',
                    content: 'Recuerden que la fecha l√≠mite para la entrega del proyecto final es el 15 de diciembre. Cualquier duda, pueden contactarme.',
                    timestamp: '2024-11-01T10:30:00',
                    read: false,
                    type: 'academic'
                },
                {
                    id: 'msg_002',
                    sender: 'Coordinaci√≥n de Sistemas',
                    senderRole: 'Administraci√≥n',
                    subject: 'Actualizaci√≥n de horarios',
                    content: 'Les informamos que los horarios del segundo semestre han sido actualizados. Revisen sus horarios en la secci√≥n correspondiente.',
                    timestamp: '2024-10-28T14:15:00',
                    read: true,
                    type: 'administrative'
                },
                {
                    id: 'msg_003',
                    sender: 'Prof. Ana Garc√≠a',
                    senderRole: 'Maestro',
                    subject: 'Clase cancelada',
                    content: 'Informo que la clase de Matem√°tica I del d√≠a de hoy est√° cancelada. Se reprogramar√° para el viernes.',
                    timestamp: '2024-10-25T08:45:00',
                    read: true,
                    type: 'academic'
                }
            ];
            
            // Datos simulados para eventos
            const events = [
                {
                    id: 'evt_001',
                    title: 'Entrega de Proyecto Final',
                    description: 'Fecha l√≠mite para la entrega del proyecto final de todas las materias',
                    date: '2024-12-15',
                    time: '23:59',
                    type: 'deadline',
                    priority: 'high'
                },
                {
                    id: 'evt_002',
                    title: 'Examen Parcial',
                    description: 'Examen parcial de Programaci√≥n I',
                    date: '2024-11-20',
                    time: '09:00',
                    type: 'exam',
                    priority: 'medium'
                },
                {
                    id: 'evt_003',
                    title: 'Feria de Ciencias',
                    description: 'Evento acad√©mico para presentaci√≥n de proyectos de investigaci√≥n',
                    date: '2024-11-25',
                    time: '10:00',
                    type: 'event',
                    priority: 'low'
                }
            ];
            
            let messagesContent = '';
            
            if (currentRole === 'estudiante') {
                // Vista para estudiantes
                messagesContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Mensajes y Eventos</h1>
                            <button onclick="showNewMessageModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                Nuevo Mensaje
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg overflow-hidden">
                                <div class="p-4 border-b border-gray-200">
                                    <h2 class="text-lg font-medium text-gray-900">Mensajes</h2>
                                </div>
                                <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
                                    ${messages.map(msg => `
                                        <div class="p-4 ${msg.read ? '' : 'bg-blue-50'}" onclick="viewMessage('${msg.id}')">
                                            <div class="flex items-start justify-between">
                                                <div class="flex-1 min-w-0">
                                                    <div class="flex items-center">
                                                        <p class="text-sm font-medium text-gray-900 truncate">${msg.sender}</p>
                                                        <p class="ml-2 text-xs text-gray-500">${msg.senderRole}</p>
                                                        ${!msg.read ? '<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Nuevo</span>' : ''}
                                                    </div>
                                                    <p class="text-sm font-medium text-gray-900 mt-1">${msg.subject}</p>
                                                    <p class="text-sm text-gray-500 truncate">${msg.content.substring(0, 80)}${msg.content.length > 80 ? '...' : ''}</p>
                                                    <p class="text-xs text-gray-400 mt-1">${new Date(msg.timestamp).toLocaleString()}</p>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    
                                    ${messages.length === 0 ? `
                                        <div class="p-8 text-center">
                                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                            </svg>
                                            <h3 class="mt-2 text-sm font-medium text-gray-900">No hay mensajes</h3>
                                            <p class="mt-1 text-sm text-gray-500">No tienes mensajes nuevos.</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg overflow-hidden">
                                <div class="p-4 border-b border-gray-200">
                                    <h2 class="text-lg font-medium text-gray-900">Eventos</h2>
                                </div>
                                <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
                                    ${events.map(event => `
                                        <div class="p-4">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0">
                                                    <div class="flex items-center justify-center h-10 w-10 rounded-md ${
                                                        event.priority === 'high' ? 'bg-red-100' : 
                                                        event.priority === 'medium' ? 'bg-yellow-100' : 'bg-green-100'
                                                    }">
                                                        <svg class="h-5 w-5 ${
                                                            event.priority === 'high' ? 'text-red-600' : 
                                                            event.priority === 'medium' ? 'text-yellow-600' : 'text-green-600'
                                                        }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div class="ml-3 flex-1">
                                                    <p class="text-sm font-medium text-gray-900">${event.title}</p>
                                                    <p class="text-sm text-gray-500">${event.description}</p>
                                                    <div class="mt-2 flex items-center text-sm text-gray-500">
                                                        <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                        </svg>
                                                        ${new Date(event.date).toLocaleDateString()} a las ${event.time}
                                                    </div>
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                                        event.priority === 'high' ? 'bg-red-100 text-red-800' : 
                                                        event.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'
                                                    } mt-2">
                                                        ${event.priority === 'high' ? 'Alta' : event.priority === 'medium' ? 'Media' : 'Baja'} prioridad
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    
                                    ${events.length === 0 ? `
                                        <div class="p-8 text-center">
                                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                            </svg>
                                            <h3 class="mt-2 text-sm font-medium text-gray-900">No hay eventos</h3>
                                            <p class="mt-1 text-sm text-gray-500">No hay eventos programados.</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentRole === 'maestro') {
                // Vista para maestros
                messagesContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Mensajes y Eventos</h1>
                            <div class="flex space-x-2">
                                <button onclick="showNewMessageModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Nuevo Mensaje
                                </button>
                                <button onclick="showNewEventModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Nuevo Evento
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg overflow-hidden">
                                <div class="p-4 border-b border-gray-200">
                                    <h2 class="text-lg font-medium text-gray-900">Mensajes</h2>
                                </div>
                                <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
                                    ${messages.map(msg => `
                                        <div class="p-4 ${msg.read ? '' : 'bg-blue-50'}" onclick="viewMessage('${msg.id}')">
                                            <div class="flex items-start justify-between">
                                                <div class="flex-1 min-w-0">
                                                    <div class="flex items-center">
                                                        <p class="text-sm font-medium text-gray-900 truncate">${msg.sender}</p>
                                                        <p class="ml-2 text-xs text-gray-500">${msg.senderRole}</p>
                                                        ${!msg.read ? '<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Nuevo</span>' : ''}
                                                    </div>
                                                    <p class="text-sm font-medium text-gray-900 mt-1">${msg.subject}</p>
                                                    <p class="text-sm text-gray-500 truncate">${msg.content.substring(0, 80)}${msg.content.length > 80 ? '...' : ''}</p>
                                                    <p class="text-xs text-gray-400 mt-1">${new Date(msg.timestamp).toLocaleString()}</p>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    
                                    ${messages.length === 0 ? `
                                        <div class="p-8 text-center">
                                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                            </svg>
                                            <h3 class="mt-2 text-sm font-medium text-gray-900">No hay mensajes</h3>
                                            <p class="mt-1 text-sm text-gray-500">No tienes mensajes nuevos.</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg overflow-hidden">
                                <div class="p-4 border-b border-gray-200">
                                    <h2 class="text-lg font-medium text-gray-900">Eventos</h2>
                                </div>
                                <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
                                    ${events.map(event => `
                                        <div class="p-4">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0">
                                                    <div class="flex items-center justify-center h-10 w-10 rounded-md ${
                                                        event.priority === 'high' ? 'bg-red-100' : 
                                                        event.priority === 'medium' ? 'bg-yellow-100' : 'bg-green-100'
                                                    }">
                                                        <svg class="h-5 w-5 ${
                                                            event.priority === 'high' ? 'text-red-600' : 
                                                            event.priority === 'medium' ? 'text-yellow-600' : 'text-green-600'
                                                        }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div class="ml-3 flex-1">
                                                    <p class="text-sm font-medium text-gray-900">${event.title}</p>
                                                    <p class="text-sm text-gray-500">${event.description}</p>
                                                    <div class="mt-2 flex items-center text-sm text-gray-500">
                                                        <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                        </svg>
                                                        ${new Date(event.date).toLocaleDateString()} a las ${event.time}
                                                    </div>
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                                        event.priority === 'high' ? 'bg-red-100 text-red-800' : 
                                                        event.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'
                                                    } mt-2">
                                                        ${event.priority === 'high' ? 'Alta' : event.priority === 'medium' ? 'Media' : 'Baja'} prioridad
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    
                                    ${events.length === 0 ? `
                                        <div class="p-8 text-center">
                                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                            </svg>
                                            <h3 class="mt-2 text-sm font-medium text-gray-900">No hay eventos</h3>
                                            <p class="mt-1 text-sm text-gray-500">No hay eventos programados.</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Vista para administradores y otros roles
                messagesContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Mensajes y Eventos</h1>
                            <div class="flex space-x-2">
                                <button onclick="showNewMessageModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Nuevo Mensaje
                                </button>
                                <button onclick="showNewEventModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Nuevo Evento
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white shadow rounded-lg overflow-hidden">
                                <div class="p-4 border-b border-gray-200">
                                    <h2 class="text-lg font-medium text-gray-900">Mensajes</h2>
                                </div>
                                <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
                                    ${messages.map(msg => `
                                        <div class="p-4 ${msg.read ? '' : 'bg-blue-50'}" onclick="viewMessage('${msg.id}')">
                                            <div class="flex items-start justify-between">
                                                <div class="flex-1 min-w-0">
                                                    <div class="flex items-center">
                                                        <p class="text-sm font-medium text-gray-900 truncate">${msg.sender}</p>
                                                        <p class="ml-2 text-xs text-gray-500">${msg.senderRole}</p>
                                                        ${!msg.read ? '<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Nuevo</span>' : ''}
                                                    </div>
                                                    <p class="text-sm font-medium text-gray-900 mt-1">${msg.subject}</p>
                                                    <p class="text-sm text-gray-500 truncate">${msg.content.substring(0, 80)}${msg.content.length > 80 ? '...' : ''}</p>
                                                    <p class="text-xs text-gray-400 mt-1">${new Date(msg.timestamp).toLocaleString()}</p>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    
                                    ${messages.length === 0 ? `
                                        <div class="p-8 text-center">
                                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                            </svg>
                                            <h3 class="mt-2 text-sm font-medium text-gray-900">No hay mensajes</h3>
                                            <p class="mt-1 text-sm text-gray-500">No tienes mensajes nuevos.</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg overflow-hidden">
                                <div class="p-4 border-b border-gray-200">
                                    <h2 class="text-lg font-medium text-gray-900">Eventos</h2>
                                </div>
                                <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
                                    ${events.map(event => `
                                        <div class="p-4">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0">
                                                    <div class="flex items-center justify-center h-10 w-10 rounded-md ${
                                                        event.priority === 'high' ? 'bg-red-100' : 
                                                        event.priority === 'medium' ? 'bg-yellow-100' : 'bg-green-100'
                                                    }">
                                                        <svg class="h-5 w-5 ${
                                                            event.priority === 'high' ? 'text-red-600' : 
                                                            event.priority === 'medium' ? 'text-yellow-600' : 'text-green-600'
                                                        }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div class="ml-3 flex-1">
                                                    <p class="text-sm font-medium text-gray-900">${event.title}</p>
                                                    <p class="text-sm text-gray-500">${event.description}</p>
                                                    <div class="mt-2 flex items-center text-sm text-gray-500">
                                                        <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                        </svg>
                                                        ${new Date(event.date).toLocaleDateString()} a las ${event.time}
                                                    </div>
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                                        event.priority === 'high' ? 'bg-red-100 text-red-800' : 
                                                        event.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'
                                                    } mt-2">
                                                        ${event.priority === 'high' ? 'Alta' : event.priority === 'medium' ? 'Media' : 'Baja'} prioridad
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    
                                    ${events.length === 0 ? `
                                        <div class="p-8 text-center">
                                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                            </svg>
                                            <h3 class="mt-2 text-sm font-medium text-gray-900">No hay eventos</h3>
                                            <p class="mt-1 text-sm text-gray-500">No hay eventos programados.</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('contentArea').innerHTML = messagesContent;
        }

        // Cargar contenido de mi perfil
        function loadProfileContent() {
            let profileContent = `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-xl font-semibold text-gray-900">Mi Perfil</h1>
                        <button onclick="editProfile()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            Editar Perfil
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1">
                            <div class="bg-white shadow rounded-lg overflow-hidden">
                                <div class="p-6">
                                    <div class="flex flex-col items-center">
                                        <div class="flex-shrink-0">
                                            <div class="h-24 w-24 rounded-full bg-indigo-100 flex items-center justify-center">
                                                <span class="text-indigo-800 font-bold text-3xl">${currentUserData.name.charAt(0)}</span>
                                            </div>
                                        </div>
                                        <div class="mt-4 text-center">
                                            <h3 class="text-lg font-medium text-gray-900">${currentUserData.name}</h3>
                                            <p class="text-sm text-gray-500">${getRoleDisplayName(currentUserData.role)}</p>
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                                currentUserData.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                            } mt-2">
                                                ${currentUserData.status === 'active' ? 'Activo' : 'Inactivo'}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 pt-6 border-t border-gray-200">
                                        <h4 class="text-sm font-medium text-gray-900">Informaci√≥n de Contacto</h4>
                                        <div class="mt-2 space-y-2">
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-2 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                                                </svg>
                                                ${currentUserData.email}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-2 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
                                                </svg>
                                                ${currentUserData.phone || 'No disponible'}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 pt-6 border-t border-gray-200">
                                        <h4 class="text-sm font-medium text-gray-900">ID del Usuario</h4>
                                        <p class="mt-2 text-sm text-gray-500">
                                            ${currentUserData.type === 'student' ? currentUserData.student_id : currentUserData.employee_id}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2">
                            <div class="bg-white shadow rounded-lg overflow-hidden">
                                <div class="p-6">
                                    <h3 class="text-lg font-medium text-gray-900 mb-4">Informaci√≥n Detallada</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            `;
            
            if (currentUserData.type === 'student') {
                // Informaci√≥n para estudiantes
                profileContent += `
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Carrera</label>
                                            <p class="mt-1 text-sm text-gray-900">${currentUserData.career}</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Semestre</label>
                                            <p class="mt-1 text-sm text-gray-900">${currentUserData.semester}¬∞</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Materias Inscritas</label>
                                            <p class="mt-1 text-sm text-gray-900">${(currentUserData.courses ? JSON.parse(currentUserData.courses).length : 0)}</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Promedio</label>
                                            <p class="mt-1 text-sm text-gray-900">85.5</p>
                                        </div>
                                        
                                        <div class="mt-6 pt-6 border-t border-gray-200">
                                            <div class="flex justify-between items-center mb-4">
                                                <h4 class="text-sm font-medium text-gray-900">Historial de Pagos</h4>
                                                <button onclick="showPaymentModal()" class="text-xs text-indigo-600 hover:text-indigo-500">
                                                    Realizar Pago
                                                </button>
                                            </div>
                                            <div class="mt-2 space-y-2 max-h-40 overflow-y-auto">
                                                ${(currentUserData.payments ? JSON.parse(currentUserData.payments) : []).map(payment => `
                                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                        <div>
                                                            <p class="text-sm font-medium text-gray-900">${payment.concept === 'matricula' ? 'Matr√≠cula' : payment.concept === 'mensualidad' ? 'Mensualidad' : payment.concept === 'material' ? 'Material Acad√©mico' : 'Otros'}</p>
                                                            <p class="text-xs text-gray-500">${new Date(payment.date).toLocaleDateString()}</p>
                                                        </div>
                                                        <span class="text-xs font-medium ${payment.status === 'completed' ? 'text-green-600' : 'text-yellow-600'}">
                                                            Q${payment.amount.toFixed(2)}
                                                        </span>
                                                    </div>
                                                `).reverse().slice(0, 5).join('') || '<p class="text-sm text-gray-500">No hay pagos registrados</p>'}
                                            </div>
                                        </div>
                `;
            } else {
                // Informaci√≥n para empleados
                profileContent += `
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Departamento</label>
                                            <p class="mt-1 text-sm text-gray-900">${currentUserData.role === 'maestro' ? 'Acad√©mico' : 'Administrativo'}</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Fecha de Contrataci√≥n</label>
                                            <p class="mt-1 text-sm text-gray-900">${new Date(currentUserData.created_at).toLocaleDateString()}</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Materias Asignadas</label>
                                            <p class="mt-1 text-sm text-gray-900">${currentUserData.assigned_subjects ? JSON.parse(currentUserData.assigned_subjects).length : 0}</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Permisos</label>
                                            <p class="mt-1 text-sm text-gray-900">${currentUserData.permissions ? JSON.parse(currentUserData.permissions).length : 0} permisos</p>
                                        </div>
                `;
            }
            
            profileContent += `
                                    </div>
                                    
                                    <div class="mt-6 pt-6 border-t border-gray-200">
                                        <h4 class="text-sm font-medium text-gray-900">Actividad Reciente</h4>
                                        <div class="mt-2 space-y-3">
                                            <div class="flex items-start space-x-3">
                                                <div class="flex-shrink-0">
                                                    <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                                                </div>
                                                <div class="flex-1">
                                                    <p class="text-sm text-gray-900">Inicio de sesi√≥n</p>
                                                    <p class="text-xs text-gray-500">Hace 2 horas</p>
                                                </div>
                                            </div>
                                            <div class="flex items-start space-x-3">
                                                <div class="flex-shrink-0">
                                                    <div class="w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                                                </div>
                                                <div class="flex-1">
                                                    <p class="text-sm text-gray-900">Actualizaci√≥n de perfil</p>
                                                    <p class="text-xs text-gray-500">Hace 3 d√≠as</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 pt-6 border-t border-gray-200">
                                        <h4 class="text-sm font-medium text-gray-900">Pagos</h4>
                                        <div class="mt-2">
                                            <button onclick="showPaymentModal()" class="w-full inline-flex justify-center items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                                <svg class="-ml-1 mr-2 h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                Realizar Pago
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = profileContent;
        }

        // Editar perfil
        function editProfile() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Editar Perfil</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="profileName" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                                <input id="profileName" type="text" value="${currentUserData.name}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="profileEmail" class="block text-sm font-medium text-gray-700">Email</label>
                                <input id="profileEmail" type="email" value="${currentUserData.email}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="profilePhone" class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                                <input id="profilePhone" type="text" value="${currentUserData.phone || ''}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            ${currentUserData.type === 'student' ? `
                                <div>
                                    <label for="profileCareer" class="block text-sm font-medium text-gray-700">Carrera</label>
                                    <select id="profileCareer" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="Ingenier√≠a en Sistemas" ${currentUserData.career === 'Ingenier√≠a en Sistemas' ? 'selected' : ''}>Ingenier√≠a en Sistemas</option>
                                        <option value="Medicina" ${currentUserData.career === 'Medicina' ? 'selected' : ''}>Medicina</option>
                                        <option value="Derecho" ${currentUserData.career === 'Derecho' ? 'selected' : ''}>Derecho</option>
                                        <option value="Administraci√≥n" ${currentUserData.career === 'Administraci√≥n' ? 'selected' : ''}>Administraci√≥n</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="profileSemester" class="block text-sm font-medium text-gray-700">Semestre</label>
                                    <select id="profileSemester" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="1" ${currentUserData.semester === '1' ? 'selected' : ''}>1</option>
                                        <option value="2" ${currentUserData.semester === '2' ? 'selected' : ''}>2</option>
                                        <option value="3" ${currentUserData.semester === '3' ? 'selected' : ''}>3</option>
                                        <option value="4" ${currentUserData.semester === '4' ? 'selected' : ''}>4</option>
                                    </select>
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="updateProfile()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Guardar Cambios </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Mostrar modal de pagos
        function showPaymentModal() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Realizar Pago - Neolink</h3>
                        <div class="space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <svg class="h-6 w-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <h4 class="text-sm font-medium text-blue-800">Pago seguro a trav√©s de Neolink</h4>
                                        <p class="text-xs text-blue-700">Todos los pagos son procesados de forma segura</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Concepto de Pago</label>
                                <select id="paymentConcept" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="matricula">Matr√≠cula</option>
                                    <option value="mensualidad">Mensualidad</option>
                                    <option value="material">Material Acad√©mico</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="paymentAmount" class="block text-sm font-medium text-gray-700">Monto a Pagar (Q)</label>
                                <input id="paymentAmount" type="number" step="0.01" min="0" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="0.00">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700">M√©todo de Pago</label>
                                <div class="mt-2 grid grid-cols-2 gap-3">
                                    <label class="inline-flex items-center p-3 bg-white border border-gray-300 rounded-md cursor-pointer hover:bg-gray-50">
                                        <input type="radio" name="paymentMethod" value="tarjeta" class="h-4 w-4 text-indigo-600 border-gray-300" checked>
                                        <div class="ml-3">
                                            <p class="text-sm font-medium text-gray-900">Tarjeta</p>
                                            <p class="text-xs text-gray-500">Visa, Mastercard</p>
                                        </div>
                                    </label>
                                    <label class="inline-flex items-center p-3 bg-white border border-gray-300 rounded-md cursor-pointer hover:bg-gray-50">
                                        <input type="radio" name="paymentMethod" value="transferencia" class="h-4 w-4 text-indigo-600 border-gray-300">
                                        <div class="ml-3">
                                            <p class="text-sm font-medium text-gray-900">Transferencia</p>
                                            <p class="text-xs text-gray-500">Banco</p>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <div id="cardDetails" class="space-y-3">
                                <div>
                                    <label for="cardNumber" class="block text-sm font-medium text-gray-700">N√∫mero de Tarjeta</label>
                                    <input id="cardNumber" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="1234 5678 9012 3456">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label for="cardExpiry" class="block text-sm font-medium text-gray-700">Fecha de Expiraci√≥n</label>
                                        <input id="cardExpiry" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="MM/YY">
                                    </div>
                                    <div>
                                        <label for="cardCvc" class="block text-sm font-medium text-gray-700">CVC</label>
                                        <input id="cardCvc" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="123">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="processPayment()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Procesar Pago </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
            
            // Mostrar/ocultar detalles de tarjeta seg√∫n m√©todo seleccionado
            document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const cardDetails = document.getElementById('cardDetails');
                    if (this.value === 'tarjeta') {
                        cardDetails.classList.remove('hidden');
                    } else {
                        cardDetails.classList.add('hidden');
                    }
                });
            });
        }

        // Procesar pago
        function processPayment() {
            const concept = document.getElementById('paymentConcept').value;
            const amount = document.getElementById('paymentAmount').value;
            const method = document.querySelector('input[name="paymentMethod"]:checked').value;
            
            // Validaciones
            if (!amount || amount <= 0) {
                showNotification('Por favor ingrese un monto v√°lido', 'error');
                return;
            }
            
            if (method === 'tarjeta') {
                const cardNumber = document.getElementById('cardNumber').value;
                const cardExpiry = document.getElementById('cardExpiry').value;
                const cardCvc = document.getElementById('cardCvc').value;
                
                if (!cardNumber || !cardExpiry || !cardCvc) {
                    showNotification('Por favor complete todos los datos de la tarjeta', 'error');
                    return;
                }
            }
            
            showNotification('Procesando pago a trav√©s de Neolink...', 'info');
            
            // Simular proceso de pago
            setTimeout(() => {
                // Registrar el pago en el sistema
                const payment = {
                    id: `pay_${Date.now()}`,
                    concept: concept,
                    amount: parseFloat(amount),
                    method: method,
                    date: new Date().toISOString(),
                    status: 'completed'
                };
                
                // Actualizar datos del estudiante con el nuevo pago
                if (currentUserData.type === 'student') {
                    const payments = currentUserData.payments ? JSON.parse(currentUserData.payments) : [];
                    payments.push(payment);
                    currentUserData.payments = JSON.stringify(payments);
                    
                    // Actualizar en el array local
                    const userIndex = allData.findIndex(item => item.id === currentUserData.id);
                    if (userIndex !== -1) {
                        allData[userIndex].payments = JSON.stringify(payments);
                    }
                }
                
                showNotification('Pago procesado exitosamente', 'success');
                hideRegisterModal();
            }, 2000);
        }

        // Actualizar perfil
        async function updateProfile() {
            const name = document.getElementById('profileName').value.trim();
            const email = document.getElementById('profileEmail').value.trim();
            const phone = document.getElementById('profilePhone').value.trim();
            
            // Validaciones
            if (!name || !email) {
                showNotification('Por favor complete los campos obligatorios', 'error');
                return;
            }
            
            showLoading();
            
            // Actualizar datos del usuario
            currentUserData.name = name;
            currentUserData.email = email;
            currentUserData.phone = phone;
            
            if (currentUserData.type === 'student') {
                const career = document.getElementById('profileCareer').value;
                const semester = document.getElementById('profileSemester').value;
                currentUserData.career = career;
                currentUserData.semester = semester;
            }
            
            // Actualizar en el array local
            const userIndex = allData.findIndex(item => item.id === currentUserData.id);
            if (userIndex !== -1) {
                allData[userIndex] = {...allData[userIndex], ...currentUserData};
            }
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.update(currentUserData);
                if (result.isOk) {
                    showNotification('Perfil actualizado exitosamente', 'success');
                    hideRegisterModal();
                    // Actualizar informaci√≥n en el header
                    document.getElementById('welcomeUser').textContent = `Bienvenido, ${currentUserData.name}`;
                    loadProfileContent();
                } else {
                    showNotification('Error al actualizar perfil', 'error');
                }
            } else {
                // Fallback: mostrar √©xito ya que ya actualizamos el array local
                showNotification('Perfil actualizado exitosamente', 'success');
                hideRegisterModal();
                // Actualizar informaci√≥n en el header
                document.getElementById('welcomeUser').textContent = `Bienvenido, ${currentUserData.name}`;
                loadProfileContent();
            }
            
            hideLoading();
        }

        // Cargar contenido de inscripciones
        function loadEnrollmentContent() {
            let enrollmentContent = '';
            
            if (currentRole === 'estudiante') {
                // Vista para estudiantes - inscribirse en materias
                const myCareer = currentUserData.career;
                const mySemester = currentUserData.semester;
                
                // Obtener materias disponibles para la carrera y semestre del estudiante
                const availableSubjects = subjectsByCareer[myCareer] && subjectsByCareer[myCareer][mySemester] ? 
                    subjectsByCareer[myCareer][mySemester] : [];
                
                // Obtener materias ya inscritas
                const enrolledCourses = currentUserData.courses ? JSON.parse(currentUserData.courses) : [];
                
                enrollmentContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Inscripci√≥n de Materias</h1>
                            <div class="text-sm text-gray-600">
                                ${enrolledCourses.length} de ${availableSubjects.length} materias inscritas
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div class="lg:col-span-2">
                                <div class="bg-white shadow rounded-lg overflow-hidden">
                                    <div class="p-4 border-b border-gray-200">
                                        <h3 class="text-lg font-medium text-gray-900">Materias Disponibles</h3>
                                        <p class="text-sm text-gray-500">${myCareer} - Semestre ${mySemester}</p>
                                    </div>
                                    
                                    <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
                                        ${availableSubjects.map(subject => {
                                            const isEnrolled = enrolledCourses.some(course => course.code === subject.code);
                                            return `
                                                <div class="p-4 flex items-center justify-between">
                                                    <div>
                                                        <h4 class="text-sm font-medium text-gray-900">${subject.name}</h4>
                                                        <p class="text-sm text-gray-500">${subject.code} ‚Ä¢ ${subject.credits} cr√©ditos</p>
                                                    </div>
                                                    <div class="flex items-center space-x-2">
                                                        ${isEnrolled ? `
                                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                                Inscrito
                                                            </span>
                                                        ` : `
                                                            <button onclick="enrollInSubject('${subject.code}')" class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                                Inscribir
                                                            </button>
                                                        `}
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="bg-white shadow rounded-lg p-6 mb-6">
                                    <h3 class="text-lg font-medium text-gray-900 mb-4">Resumen de Inscripci√≥n</h3>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600">Materias Inscritas</span>
                                            <span class="font-medium text-gray-900">${enrolledCourses.length}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600">Cr√©ditos Totales</span>
                                            <span class="font-medium text-gray-900">${enrolledCourses.reduce((total, course) => total + (course.credits || 0), 0)}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-sm text-gray-600">Cr√©ditos M√°ximos</span>
                                            <span class="font-medium text-gray-900">20</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 pt-4 border-t border-gray-200">
                                        <button onclick="submitEnrollment()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-md text-sm font-medium">
                                            Confirmar Inscripci√≥n
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="bg-white shadow rounded-lg p-6">
                                    <h3 class="text-lg font-medium text-gray-900 mb-4">Materias Inscritas</h3>
                                    <div class="space-y-3 max-h-60 overflow-y-auto">
                                        ${enrolledCourses.length > 0 ? enrolledCourses.map(course => `
                                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                <div>
                                                    <p class="text-sm font-medium text-gray-900">${course.name}</p>
                                                    <p class="text-xs text-gray-500">${course.code}</p>
                                                </div>
                                                <button onclick="unenrollFromSubject('${course.code}')" class="text-red-600 hover:text-red-900 text-xs">
                                                    Eliminar
                                                </button>
                                            </div>
                                        `).join('') : `
                                            <p class="text-sm text-gray-500 text-center py-4">No hay materias inscritas</p>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentRole === 'administrador' || currentRole === 'coordinador') {
                // Vista para administradores y coordinadores - gestionar inscripciones
                const students = allData.filter(item => item.type === 'student');
                
                enrollmentContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Gesti√≥n de Inscripciones</h1>
                            <div class="text-sm text-gray-600">
                                ${students.length} estudiantes
                            </div>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estudiante</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Carrera</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Semestre</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materias Inscritas</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${students.map(student => {
                                        const enrolledCourses = student.courses ? JSON.parse(student.courses) : [];
                                        return `
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.name}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.career}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.semester}¬∞</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${enrolledCourses.length}</td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                                        Confirmada
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                    <button onclick="viewStudentEnrollment('${student.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Ver Detalles</button>
                                                    <button onclick="editStudentEnrollment('${student.id}')" class="text-indigo-600 hover:text-indigo-900">Editar</button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('contentArea').innerHTML = enrollmentContent;
        }

        // Inscribir en materia
        async function enrollInSubject(subjectCode) {
            // Encontrar la materia
            const career = currentUserData.career;
            const semester = currentUserData.semester;
            const subject = subjectsByCareer[career] && subjectsByCareer[career][semester] ?
                subjectsByCareer[career][semester].find(s => s.code === subjectCode) : null;
            
            if (!subject) {
                showNotification('Materia no encontrada', 'error');
                return;
            }
            
            // Verificar si ya est√° inscrito
            const enrolledCourses = currentUserData.courses ? JSON.parse(currentUserData.courses) : [];
            if (enrolledCourses.some(course => course.code === subjectCode)) {
                showNotification('Ya est√°s inscrito en esta materia', 'error');
                return;
            }
            
            // Agregar la materia a las inscripciones
            enrolledCourses.push({
                code: subject.code,
                name: subject.name,
                credits: subject.credits,
                semester: semester,
                career: career,
                teacher: 'Profesor por asignar',
                classroom: 'Aula por asignar',
                progress: 0
            });
            
            // Actualizar datos del usuario
            currentUserData.courses = JSON.stringify(enrolledCourses);
            
            // Actualizar en el array local
            const userIndex = allData.findIndex(item => item.id === currentUserData.id);
            if (userIndex !== -1) {
                allData[userIndex].courses = JSON.stringify(enrolledCourses);
            }
            
            showNotification(`Inscrito en ${subject.name}`, 'success');
            loadEnrollmentContent();
        }

        // Eliminar inscripci√≥n de materia
        async function unenrollFromSubject(subjectCode) {
            // Obtener materias inscritas
            const enrolledCourses = currentUserData.courses ? JSON.parse(currentUserData.courses) : [];
            
            // Verificar si est√° inscrito
            const courseIndex = enrolledCourses.findIndex(course => course.code === subjectCode);
            if (courseIndex === -1) {
                showNotification('No est√°s inscrito en esta materia', 'error');
                return;
            }
            
            // Eliminar la materia
            const removedCourse = enrolledCourses.splice(courseIndex, 1)[0];
            
            // Actualizar datos del usuario
            currentUserData.courses = JSON.stringify(enrolledCourses);
            
            // Actualizar en el array local
            const userIndex = allData.findIndex(item => item.id === currentUserData.id);
            if (userIndex !== -1) {
                allData[userIndex].courses = JSON.stringify(enrolledCourses);
            }
            
            showNotification(`Eliminado de ${removedCourse.name}`, 'success');
            loadEnrollmentContent();
        }

        // Confirmar inscripci√≥n
        async function submitEnrollment() {
            const enrolledCourses = currentUserData.courses ? JSON.parse(currentUserData.courses) : [];
            
            if (enrolledCourses.length === 0) {
                showNotification('Debes inscribir al menos una materia', 'error');
                return;
            }
            
            showNotification('Inscripci√≥n confirmada exitosamente', 'success');
        }

        // Ver inscripci√≥n de estudiante
        function viewStudentEnrollment(studentId) {
            showNotification('Viendo detalles de inscripci√≥n del estudiante', 'info');
        }

        // Editar inscripci√≥n de estudiante
        function editStudentEnrollment(studentId) {
            showNotification('Editando inscripci√≥n del estudiante', 'info');
        }

        // Cargar contenido de reportes
        function loadReportsContent() {
            // Datos simulados para reportes
            const reportData = {
                totalStudents: 1245,
                totalTeachers: 87,
                totalCourses: 156,
                activeEnrollments: 3421,
                averageGrade: 82.5,
                graduationRate: 87.3,
                attendanceRate: 92.1
            };
            
            let reportsContent = `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-xl font-semibold text-gray-900">Reportes y Estad√≠sticas</h1>
                        <div class="flex space-x-2">
                            <select class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                <option>Este mes</option>
                                <option>√öltimo trimestre</option>
                                <option>Este a√±o</option>
                            </select>
                            <button class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-md text-sm font-medium border border-gray-300">
                                Exportar
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                            <span class="text-white font-bold">üë•</span>
                                        </div>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 truncate">Estudiantes</dt>
                                            <dd class="text-lg font-medium text-gray-900">${reportData.totalStudents}</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                            <span class="text-white font-bold">üë®‚Äçüè´</span>
                                        </div>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 truncate">Maestros</dt>
                                            <dd class="text-lg font-medium text-gray-900">${reportData.totalTeachers}</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                                            <span class="text-white font-bold">üìö</span>
                                        </div>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 truncate">Materias</dt>
                                            <dd class="text-lg font-medium text-gray-900">${reportData.totalCourses}</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="p-5">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                                            <span class="text-white font-bold">üìù</span>
                                        </div>
                                    </div>
                                    <div class="ml-5 w-0 flex-1">
                                        <dl>
                                            <dt class="text-sm font-medium text-gray-500 truncate">Inscripciones</dt>
                                            <dd class="text-lg font-medium text-gray-900">${reportData.activeEnrollments}</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Rendimiento Acad√©mico</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm font-medium text-gray-700">Promedio General</span>
                                        <span class="text-sm font-medium text-gray-700">${reportData.averageGrade}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: ${reportData.averageGrade}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm font-medium text-gray-700">Tasa de Graduaci√≥n</span>
                                        <span class="text-sm font-medium text-gray-700">${reportData.graduationRate}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-600 h-2 rounded-full" style="width: ${reportData.graduationRate}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm font-medium text-gray-700">Asistencia</span>
                                        <span class="text-sm font-medium text-gray-700">${reportData.attendanceRate}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-yellow-600 h-2 rounded-full" style="width: ${reportData.attendanceRate}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Distribuci√≥n por Carreras</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-700">Ingenier√≠a en Sistemas</span>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900">42%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-700">Medicina</span>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900">28%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-700">Derecho</span>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900">18%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-purple-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-700">Administraci√≥n</span>
                                    </div>
                                    <span class="text-sm font-medium text-gray-900">12%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Reportes Disponibles</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="generateReport('student_list')">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 w-10 h-10 bg-blue-100 rounded-md flex items-center justify-center">
                                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <h4 class="text-sm font-medium text-gray-900">Lista de Estudiantes</h4>
                                        <p class="text-xs text-gray-500">Todos los estudiantes registrados</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="generateReport('grades_report')">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 w-10 h-10 bg-green-100 rounded-md flex items-center justify-center">
                                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <h4 class="text-sm font-medium text-gray-900">Reporte de Calificaciones</h4>
                                        <p class="text-xs text-gray-500">Promedios por materia y carrera</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="generateReport('attendance_report')">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 w-10 h-10 bg-yellow-100 rounded-md flex items-center justify-center">
                                        <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <h4 class="text-sm font-medium text-gray-900">Reporte de Asistencia</h4>
                                        <p class="text-xs text-gray-500">Asistencia por materia y estudiante</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = reportsContent;
        }

        // Generar reporte
        function generateReport(reportType) {
            let reportTitle = '';
            let reportDescription = '';
            
            switch(reportType) {
                case 'student_list':
                    reportTitle = 'Lista de Estudiantes';
                    reportDescription = 'Reporte con todos los estudiantes registrados en el sistema';
                    break;
                case 'grades_report':
                    reportTitle = 'Reporte de Calificaciones';
                    reportDescription = 'Promedios generales por materia y carrera';
                    break;
                case 'attendance_report':
                    reportTitle = 'Reporte de Asistencia';
                    reportDescription = 'Porcentajes de asistencia por materia y estudiante';
                    break;
                default:
                    reportTitle = 'Reporte Personalizado';
                    reportDescription = 'Reporte generado seg√∫n criterios seleccionados';
            }
            
            showNotification(`Generando reporte: ${reportTitle}`, 'info');
        }

        // Cargar contenido de tickets de soporte
        function loadTicketsContent() {
            // Datos simulados para tickets
            const tickets = [
                {
                    id: 'TCK-001',
                    title: 'Problema con acceso al sistema',
                    description: 'No puedo acceder al sistema de gesti√≥n educativa. Me aparece un error de autenticaci√≥n.',
                    status: 'open',
                    priority: 'high',
                    category: 'Acceso',
                    createdBy: 'Juan P√©rez',
                    createdAt: '2024-11-01T09:30:00',
                    assignedTo: 'IT Support'
                },
                {
                    id: 'TCK-002',
                    title: 'Error en reporte de calificaciones',
                    description: 'El reporte de calificaciones no se est√° generando correctamente. Faltan datos de algunos estudiantes.',
                    status: 'in_progress',
                    priority: 'medium',
                    category: 'Reportes',
                    createdBy: 'Mar√≠a Gonz√°lez',
                    createdAt: '2024-10-30T14:15:00',
                    assignedTo: 'Desarrollo'
                },
                {
                    id: 'TCK-003',
                    title: 'Solicitud de nuevo permiso',
                    description: 'Necesito acceso a la secci√≥n de reportes financieros para generar el informe mensual.',
                    status: 'closed',
                    priority: 'low',
                    category: 'Permisos',
                    createdBy: 'Carlos L√≥pez',
                    createdAt: '2024-10-28T11:45:00',
                    assignedTo: 'Administraci√≥n',
                    resolvedAt: '2024-10-29T16:20:00'
                }
            ];
            
            let ticketsContent = '';
            
            if (currentRole === 'soporte' || currentRole === 'administrador') {
                // Vista para soporte y administradores - gestionar tickets
                ticketsContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Tickets de Soporte</h1>
                            <button onclick="showCreateTicketModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                Crear Ticket
                            </button>
                        </div>
                        
                        <div class="mb-6">
                            <div class="flex space-x-2 overflow-x-auto pb-2">
                                <button class="px-3 py-1 text-sm rounded-full bg-indigo-100 text-indigo-800 font-medium">Todos</button>
                                <button class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-800 font-medium">Abiertos</button>
                                <button class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-800 font-medium">En Progreso</button>
                                <button class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-800 font-medium">Cerrados</button>
                            </div>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">T√≠tulo</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categor√≠a</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prioridad</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Creado por</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${tickets.map(ticket => `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ticket.id}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.title}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.category}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                                    ticket.priority === 'high' ? 'bg-red-100 text-red-800' : 
                                                    ticket.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 
                                                    'bg-green-100 text-green-800'
                                                }">
                                                    ${ticket.priority === 'high' ? 'Alta' : ticket.priority === 'medium' ? 'Media' : 'Baja'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                                    ticket.status === 'open' ? 'bg-red-100 text-red-800' : 
                                                    ticket.status === 'in_progress' ? 'bg-yellow-100 text-yellow-800' : 
                                                    'bg-green-100 text-green-800'
                                                }">
                                                    ${ticket.status === 'open' ? 'Abierto' : ticket.status === 'in_progress' ? 'En Progreso' : 'Cerrado'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.createdBy}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <button onclick="viewTicket('${ticket.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Ver</button>
                                                <button onclick="editTicket('${ticket.id}')" class="text-indigo-600 hover:text-indigo-900">Editar</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                // Vista para usuarios - crear y ver sus tickets
                const userTickets = tickets.filter(ticket => ticket.createdBy === currentUserData.name);
                
                ticketsContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Mis Tickets de Soporte</h1>
                            <button onclick="showCreateTicketModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                Crear Ticket
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                            ${userTickets.map(ticket => `
                                <div class="bg-white overflow-hidden shadow rounded-lg">
                                    <div class="p-6">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-lg font-medium text-gray-900">${ticket.title}</h3>
                                            <span class="px-2 py-1 text-xs rounded-full ${
                                                ticket.status === 'open' ? 'bg-red-100 text-red-800' : 
                                                ticket.status === 'in_progress' ? 'bg-yellow-100 text-yellow-800' : 
                                                'bg-green-100 text-green-800'
                                            }">
                                                ${ticket.status === 'open' ? 'Abierto' : ticket.status === 'in_progress' ? 'En Progreso' : 'Cerrado'}
                                            </span>
                                        </div>
                                        <p class="mt-2 text-sm text-gray-600">${ticket.description.substring(0, 100)}${ticket.description.length > 100 ? '...' : ''}</p>
                                        <div class="mt-4 space-y-2">
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                </svg>
                                                ${new Date(ticket.createdAt).toLocaleDateString()}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                                </svg>
                                                ${ticket.category}
                                            </div>
                                        </div>
                                        <div class="mt-6">
                                            <button onclick="viewTicket('${ticket.id}')" class="w-full inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                Ver Detalles
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        ${userTickets.length === 0 ? `
                            <div class="text-center py-12">
                                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                                </svg>
                                <h3 class="mt-2 text-lg font-medium text-gray-900">No hay tickets</h3>
                                <p class="mt-1 text-sm text-gray-500">No has creado ning√∫n ticket de soporte.</p>
                                <div class="mt-6">
                                    <button onclick="showCreateTicketModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Crear Ticket
                                    </button>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            document.getElementById('contentArea').innerHTML = ticketsContent;
        }

        // Mostrar modal para crear ticket
        function showCreateTicketModal() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Crear Nuevo Ticket</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="ticketTitle" class="block text-sm font-medium text-gray-700">T√≠tulo</label>
                                <input id="ticketTitle" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Breve descripci√≥n del problema">
                            </div>
                            <div>
                                <label for="ticketCategory" class="block text-sm font-medium text-gray-700">Categor√≠a</label>
                                <select id="ticketCategory" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione una categor√≠a</option>
                                    <option value="Acceso">Problemas de Acceso</option>
                                    <option value="Reportes">Reportes</option>
                                    <option value="Calificaciones">Calificaciones</option>
                                    <option value="Inscripciones">Inscripciones</option>
                                    <option value="Permisos">Permisos</option>
                                    <option value="Otros">Otros</option>
                                </select>
                            </div>
                            <div>
                                <label for="ticketPriority" class="block text-sm font-medium text-gray-700">Prioridad</label>
                                <select id="ticketPriority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="low">Baja</option>
                                    <option value="medium" selected>Media</option>
                                    <option value="high">Alta</option>
                                </select>
                            </div>
                            <div>
                                <label for="ticketDescription" class="block text-sm font-medium text-gray-700">Descripci√≥n Detallada</label>
                                <textarea id="ticketDescription" rows="4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Describa detalladamente el problema o solicitud"></textarea>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="createTicket()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Crear Ticket </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Crear nuevo ticket
        function createTicket() {
            const title = document.getElementById('ticketTitle').value.trim();
            const category = document.getElementById('ticketCategory').value;
            const priority = document.getElementById('ticketPriority').value;
            const description = document.getElementById('ticketDescription').value.trim();
            
            // Validaciones
            if (!title || !category || !description) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            showNotification('Ticket creado exitosamente', 'success');
            hideRegisterModal();
            loadTicketsContent();
        }

        // Ver ticket
        function viewTicket(ticketId) {
            showNotification('Viendo detalles del ticket', 'info');
        }

        // Editar ticket
        function editTicket(ticketId) {
            showNotification('Editando ticket', 'info');
        }

        // Mostrar modal para nuevo mensaje
        function showNewMessageModal() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Nuevo Mensaje</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="messageRecipient" class="block text-sm font-medium text-gray-700">Destinatario</label>
                                <select id="messageRecipient" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione un destinatario</option>
                                    <optgroup label="Estudiantes">
                                        ${allData.filter(item => item.type === 'student').map(student => `<option value="${student.id}">${student.name} (${student.email})</option>`).join('')}
                                    </optgroup>
                                    <optgroup label="Maestros">
                                        ${allData.filter(item => item.type === 'employee' && item.role === 'maestro').map(teacher => `<option value="${teacher.id}">${teacher.name} (${teacher.email})</option>`).join('')}
                                    </optgroup>
                                    <optgroup label="Administraci√≥n">
                                        ${allData.filter(item => item.type === 'employee' && item.role !== 'maestro' && item.role !== 'estudiante').map(admin => `<option value="${admin.id}">${admin.name} (${admin.email})</option>`).join('')}
                                    </optgroup>
                                </select>
                            </div>
                            <div>
                                <label for="messageSubject" class="block text-sm font-medium text-gray-700">Asunto</label>
                                <input id="messageSubject" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Asunto del mensaje">
                            </div>
                            <div>
                                <label for="messageContent" class="block text-sm font-medium text-gray-700">Contenido</label>
                                <textarea id="messageContent" rows="6" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Escriba su mensaje aqu√≠..."></textarea>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="sendMessage()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Enviar </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Enviar mensaje
        function sendMessage() {
            const recipient = document.getElementById('messageRecipient').value;
            const subject = document.getElementById('messageSubject').value.trim();
            const content = document.getElementById('messageContent').value.trim();
            
            // Validaciones
            if (!recipient || !subject || !content) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            showNotification('Mensaje enviado exitosamente', 'success');
            hideRegisterModal();
            loadMessagesContent();
        }

        // Ver mensaje
        function viewMessage(messageId) {
            showNotification('Viendo detalles del mensaje', 'info');
        }

        // Mostrar modal para nuevo evento
        function showNewEventModal() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Nuevo Evento</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="eventTitle" class="block text-sm font-medium text-gray-700">T√≠tulo</label>
                                <input id="eventTitle" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="T√≠tulo del evento">
                            </div>
                            <div>
                                <label for="eventDescription" class="block text-sm font-medium text-gray-700">Descripci√≥n</label>
                                <textarea id="eventDescription" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Descripci√≥n del evento"></textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="eventDate" class="block text-sm font-medium text-gray-700">Fecha</label>
                                    <input id="eventDate" type="date" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="eventTime" class="block text-sm font-medium text-gray-700">Hora</label>
                                    <input id="eventTime" type="time" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                            <div>
                                <label for="eventPriority" class="block text-sm font-medium text-gray-700">Prioridad</label>
                                <select id="eventPriority" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="low">Baja</option>
                                    <option value="medium" selected>Media</option>
                                    <option value="high">Alta</option>
                                </select>
                            </div>
                            <div>
                                <label for="eventRecipients" class="block text-sm font-medium text-gray-700">Destinatarios</label>
                                <select id="eventRecipients" multiple class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="all">Todos los usuarios</option>
                                    <optgroup label="Por Carrera">
                                        <option value="sistemas">Ingenier√≠a en Sistemas</option>
                                        <option value="medicina">Medicina</option>
                                        <option value="derecho">Derecho</option>
                                    </optgroup>
                                    <optgroup label="Por Rol">
                                        <option value="students">Estudiantes</option>
                                        <option value="teachers">Maestros</option>
                                        <option value="admins">Administradores</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="createEvent()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Crear Evento </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Crear evento
        function createEvent() {
            const title = document.getElementById('eventTitle').value.trim();
            const description = document.getElementById('eventDescription').value.trim();
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            
            // Validaciones
            if (!title || !description || !date || !time) {
            showNotification('Por favor complete todos los campos', 'error');
            return;
            }
            
            showNotification('Evento creado exitosamente', 'success');
            hideRegisterModal();
            loadMessagesContent();
        }

        // Cargar contenido de gesti√≥n de documentos
        function loadDocumentsContent() {
            // Datos simulados para documentos
            const documents = [
                {
                    id: 'doc_001',
                    name: 'Reglamento Estudiantil 2024.pdf',
                    type: 'pdf',
                    size: '2.4 MB',
                    uploadedBy: 'Administraci√≥n',
                    uploadedAt: '2024-10-15',
                    category: 'Reglamentos',
                    downloads: 124
                },
                {
                    id: 'doc_002',
                    name: 'Calendario Acad√©mico 2024-2025.xlsx',
                    type: 'xlsx',
                    size: '1.1 MB',
                    uploadedBy: 'Coordinaci√≥n',
                    uploadedAt: '2024-10-20',
                    category: 'Calendarios',
                    downloads: 87
                },
                {
                    id: 'doc_003',
                    name: 'Formato de Inscripci√≥n.docx',
                    type: 'docx',
                    size: '0.8 MB',
                    uploadedBy: 'Secretar√≠a',
                    uploadedAt: '2024-10-25',
                    category: 'Formularios',
                    downloads: 215
                },
                {
                    id: 'doc_004',
                    name: 'Manual de Usuario.pdf',
                    type: 'pdf',
                    size: '3.2 MB',
                    uploadedBy: 'IT Support',
                    uploadedAt: '2024-10-30',
                    category: 'Manuales',
                    downloads: 96
                }
            ];
            
            let documentsContent = '';
            
            if (currentRole === 'administrador' || currentRole === 'coordinador' || currentRole === 'secretaria') {
                // Vista para administradores, coordinadores y secretar√≠a - gestionar documentos
                documentsContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Gesti√≥n de Documentos</h1>
                            <button onclick="showUploadDocumentModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                Subir Documento
                            </button>
                        </div>
                        
                        <div class="mb-6">
                            <div class="flex space-x-2 overflow-x-auto pb-2">
                                <button class="px-3 py-1 text-sm rounded-full bg-indigo-100 text-indigo-800 font-medium">Todos</button>
                                <button class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-800 font-medium">Reglamentos</button>
                                <button class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-800 font-medium">Calendarios</button>
                                <button class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-800 font-medium">Formularios</button>
                                <button class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-800 font-medium">Manuales</button>
                            </div>
                        </div>
                        
                        <div class="bg-white shadow rounded-lg overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Documento</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categor√≠a</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tama√±o</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subido por</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descargas</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${documents.map(doc => `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="flex-shrink-0 w-8 h-8 rounded-md flex items-center justify-center bg-blue-100">
                                                        <span class="text-blue-800 font-medium text-xs">${doc.type.toUpperCase()}</span>
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-medium text-gray-900">${doc.name}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${doc.category}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${doc.size}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${doc.uploadedBy}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(doc.uploadedAt).toLocaleDateString()}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${doc.downloads}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <button onclick="downloadDocument('${doc.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Descargar</button>
                                                <button onclick="deleteDocument('${doc.id}')" class="text-red-600 hover:text-red-900">Eliminar</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } else {
                // Vista para estudiantes y maestros - ver y descargar documentos
                documentsContent = `
                    <div class="fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-xl font-semibold text-gray-900">Documentos Disponibles</h1>
                            <div class="text-sm text-gray-600">
                                ${documents.length} documentos
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${documents.map(doc => `
                                <div class="bg-white overflow-hidden shadow rounded-lg">
                                    <div class="p-6">
                                        <div class="flex items-center">
                                            <div class="flex-shrink-0 w-10 h-10 rounded-md flex items-center justify-center bg-blue-100">
                                                <span class="text-blue-800 font-medium">${doc.type.toUpperCase()}</span>
                                            </div>
                                            <div class="ml-4">
                                                <h3 class="text-lg font-medium text-gray-900">${doc.name}</h3>
                                                <p class="text-sm text-gray-500">${doc.category}</p>
                                            </div>
                                        </div>
                                        <div class="mt-4 space-y-2">
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                </svg>
                                                ${doc.size}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500">
                                                <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                                </svg>
                                                ${new Date(doc.uploadedAt).toLocaleDateString()}
                                            </div>
                                        </div>
                                        <div class="mt-6">
                                            <button onclick="downloadDocument('${doc.id}')" class="w-full inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                                </svg>
                                                Descargar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        ${documents.length === 0 ? `
                            <div class="text-center py-12">
                                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <h3 class="mt-2 text-lg font-medium text-gray-900">No hay documentos disponibles</h3>
                                <p class="mt-1 text-sm text-gray-500">No se han subido documentos a√∫n.</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            document.getElementById('contentArea').innerHTML = documentsContent;
        }

        // Mostrar modal para subir documento
        function showUploadDocumentModal() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Subir Nuevo Documento</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="documentName" class="block text-sm font-medium text-gray-700">Nombre del Documento</label>
                                <input id="documentName" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Nombre descriptivo del documento">
                            </div>
                            <div>
                                <label for="documentCategory" class="block text-sm font-medium text-gray-700">Categor√≠a</label>
                                <select id="documentCategory" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione una categor√≠a</option>
                                    <option value="Reglamentos">Reglamentos</option>
                                    <option value="Calendarios">Calendarios</option>
                                    <option value="Formularios">Formularios</option>
                                    <option value="Manuales">Manuales</option>
                                    <option value="Otros">Otros</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Archivo</label>
                                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                                    <div class="space-y-1 text-center">
                                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                        <div class="flex text-sm text-gray-600">
                                            <label for="documentFile" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500">
                                                <span>Seleccionar archivo</span>
                                                <input id="documentFile" name="documentFile" type="file" class="sr-only">
                                            </label>
                                            <p class="pl-1">o arrastrar y soltar</p>
                                        </div>
                                        <p class="text-xs text-gray-500">PDF, DOC, DOCX, XLSX hasta 10MB</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="uploadDocument()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Subir Documento </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Subir documento
        function uploadDocument() {
            const name = document.getElementById('documentName').value.trim();
            const category = document.getElementById('documentCategory').value;
            const fileInput = document.getElementById('documentFile');
            
            // Validaciones
            if (!name || !category) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            if (!fileInput.files || fileInput.files.length === 0) {
                showNotification('Por favor seleccione un archivo', 'error');
                return;
            }
            
            showNotification('Documento subido exitosamente', 'success');
            hideRegisterModal();
            loadDocumentsContent();
        }

        // Descargar documento
        function downloadDocument(documentId) {
            showNotification('Descargando documento...', 'info');
        }

        // Eliminar documento
        function deleteDocument(documentId) {
            if (confirm('¬øEst√° seguro que desea eliminar este documento?')) {
                showNotification('Documento eliminado exitosamente', 'success');
                loadDocumentsContent();
            }
        }

        // Cargar contenido de configuraci√≥n del sistema
        function loadSystemContent() {
            // Configuraci√≥n simulada
            const systemConfig = {
                institutionName: 'Universidad Tecnol√≥gica',
                academicYear: '2024-2025',
                semester: '2',
                maxCredits: 20,
                minGrade: 60,
                enableEnrollment: true,
                enableGrades: true,
                enableAttendance: true,
                lastBackup: '2024-10-31 23:59:59',
                nextBackup: '2024-11-01 23:59:59'
            };
            
            const systemContent = `
                <div class="fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-xl font-semibold text-gray-900">Configuraci√≥n del Sistema</h1>
                        <button onclick="saveSystemConfig()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            Guardar Cambios
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <div class="bg-white shadow rounded-lg overflow-hidden">
                                <div class="p-6">
                                    <h3 class="text-lg font-medium text-gray-900 mb-4">Configuraci√≥n General</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label for="institutionName" class="block text-sm font-medium text-gray-700">Nombre de la Instituci√≥n</label>
                                            <input type="text" id="institutionName" value="${systemConfig.institutionName}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                        </div>
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label for="academicYear" class="block text-sm font-medium text-gray-700">A√±o Acad√©mico</label>
                                                <input type="text" id="academicYear" value="${systemConfig.academicYear}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            </div>
                                            <div>
                                                <label for="semester" class="block text-sm font-medium text-gray-700">Semestre Actual</label>
                                                <select id="semester" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                                    <option value="1" ${systemConfig.semester === '1' ? 'selected' : ''}>Primer Semestre</option>
                                                    <option value="2" ${systemConfig.semester === '2' ? 'selected' : ''}>Segundo Semestre</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label for="maxCredits" class="block text-sm font-medium text-gray-700">M√°ximo de Cr√©ditos por Estudiante</label>
                                                <input type="number" id="maxCredits" value="${systemConfig.maxCredits}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            </div>
                                            <div>
                                                <label for="minGrade" class="block text-sm font-medium text-gray-700">Calificaci√≥n M√≠nima para Aprobar</label>
                                                <input type="number" id="minGrade" value="${systemConfig.minGrade}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg overflow-hidden mt-6">
                                <div class="p-6">
                                    <h3 class="text-lg font-medium text-gray-900 mb-4">Configuraci√≥n de M√≥dulos</h3>
                                    <div class="space-y-4">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-sm font-medium text-gray-900">Inscripciones</p>
                                                <p class="text-sm text-gray-500">Permitir inscripci√≥n de materias</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="enableEnrollment" class="sr-only peer" ${systemConfig.enableEnrollment ? 'checked' : ''}>
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                            </label>
                                        </div>
                                        
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-sm font-medium text-gray-900">Calificaciones</p>
                                                <p class="text-sm text-gray-500">Permitir registro de calificaciones</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="enableGrades" class="sr-only peer" ${systemConfig.enableGrades ? 'checked' : ''}>
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                            </label>
                                        </div>
                                        
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-sm font-medium text-gray-900">Asistencia</p>
                                                <p class="text-sm text-gray-500">Permitir registro de asistencia</p>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="enableAttendance" class="sr-only peer" ${systemConfig.enableAttendance ? 'checked' : ''}>
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="bg-white shadow rounded-lg p-6 mb-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Carreras Disponibles</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                        <span class="text-sm text-gray-900">Ingenier√≠a en Sistemas</span>
                                        <span class="text-xs text-gray-500">8 materias</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                        <span class="text-sm text-gray-900">Medicina</span>
                                        <span class="text-xs text-gray-500">12 materias</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                        <span class="text-sm text-gray-900">Derecho</span>
                                        <span class="text-xs text-gray-500">10 materias</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                        <span class="text-sm text-gray-900">Administraci√≥n</span>
                                        <span class="text-xs text-gray-500">9 materias</span>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <button onclick="showAddCareerModal()" class="w-full inline-flex justify-center items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                        Agregar Carrera
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-white shadow rounded-lg p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Mantenimiento del Sistema</h3>
                                <div class="space-y-4">
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">√öltimo Respaldo</p>
                                        <p class="text-sm text-gray-500">${systemConfig.lastBackup}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">Pr√≥ximo Respaldo</p>
                                        <p class="text-sm text-gray-500">${systemConfig.nextBackup}</p>
                                    </div>
                                    <div class="pt-4">
                                        <button onclick="performBackup()" class="w-full inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                                            Realizar Respaldo Ahora
                                        </button>
                                    </div>
                                    <div>
                                        <button onclick="clearCache()" class="w-full inline-flex justify-center items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                            Limpiar Cach√©
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = systemContent;
        }

        // Guardar configuraci√≥n del sistema
        function saveSystemConfig() {
            const institutionName = document.getElementById('institutionName').value;
            const academicYear = document.getElementById('academicYear').value;
            const semester = document.getElementById('semester').value;
            const maxCredits = document.getElementById('maxCredits').value;
            const minGrade = document.getElementById('minGrade').value;
            const enableEnrollment = document.getElementById('enableEnrollment').checked;
            const enableGrades = document.getElementById('enableGrades').checked;
            const enableAttendance = document.getElementById('enableAttendance').checked;
            
            // Validaciones
            if (!institutionName || !academicYear || !semester) {
                showNotification('Por favor complete los campos obligatorios', 'error');
                return;
            }
            
            showNotification('Configuraci√≥n guardada exitosamente', 'success');
        }

        // Mostrar modal para agregar carrera
        function showAddCareerModal() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Agregar Nueva Carrera</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="careerName" class="block text-sm font-medium text-gray-700">Nombre de la Carrera</label>
                                <input id="careerName" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Nombre completo de la carrera">
                            </div>
                            <div>
                                <label for="careerCode" class="block text-sm font-medium text-gray-700">C√≥digo</label>
                                <input id="careerCode" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="C√≥digo √∫nico de la carrera">
                            </div>
                            <div>
                                <label for="careerDuration" class="block text-sm font-medium text-gray-700">Duraci√≥n (semestres)</label>
                                <select id="careerDuration" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="6">6 semestres</option>
                                    <option value="8">8 semestres</option>
                                    <option value="10">10 semestres</option>
                                    <option value="12">12 semestres</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="addCareer()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Agregar Carrera </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Agregar carrera
        function addCareer() {
            const name = document.getElementById('careerName').value.trim();
            const code = document.getElementById('careerCode').value.trim();
            const duration = document.getElementById('careerDuration').value;
            
            // Validaciones
            if (!name || !code || !duration) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            showNotification('Carrera agregada exitosamente', 'success');
            hideRegisterModal();
        }

        // Realizar respaldo
        function performBackup() {
            showNotification('Realizando respaldo del sistema...', 'info');
            setTimeout(() => {
                showNotification('Respaldo completado exitosamente', 'success');
            }, 2000);
        }

        // Limpiar cach√©
        function clearCache() {
            if (confirm('¬øEst√° seguro que desea limpiar la cach√© del sistema?')) {
                showNotification('Limpiando cach√©...', 'info');
                setTimeout(() => {
                    showNotification('Cach√© limpiada exitosamente', 'success');
                }, 1500);
            }
        }

        // Mostrar modal de registro
        function showRegisterModal() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Registro de Nuevo Estudiante</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="regName" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                                <input id="regName" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regEmail" class="block text-sm font-medium text-gray-700">Email</label>
                                <input id="regEmail" type="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regPhone" class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                                <input id="regPhone" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regUsername" class="block text-sm font-medium text-gray-700">Nombre de Usuario</label>
                                <input id="regUsername" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regPassword" class="block text-sm font-medium text-gray-700">Contrase√±a</label>
                                <input id="regPassword" type="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regConfirmPassword" class="block text-sm font-medium text-gray-700">Confirmar Contrase√±a</label>
                                <input id="regConfirmPassword" type="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regCareer" class="block text-sm font-medium text-gray-700">Carrera</label>
                                <select id="regCareer" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione una carrera</option>
                                    <option value="Ingenier√≠a en Sistemas">Ingenier√≠a en Sistemas</option>
                                    <option value="Medicina">Medicina</option>
                                    <option value="Derecho">Derecho</option>
                                    <option value="Administraci√≥n">Administraci√≥n</option>
                                </select>
                            </div>
                            <div>
                                <label for="regSemester" class="block text-sm font-medium text-gray-700">Semestre</label>
                                <select id="regSemester" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione un semestre</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="registerStudent()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Registrarse </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Mostrar modal para agregar estudiante
        function showAddStudentModal() {
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Agregar Nuevo Estudiante</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="regName" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                                <input id="regName" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regEmail" class="block text-sm font-medium text-gray-700">Email</label>
                                <input id="regEmail" type="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regPhone" class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                                <input id="regPhone" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regUsername" class="block text-sm font-medium text-gray-700">Nombre de Usuario</label>
                                <input id="regUsername" type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regPassword" class="block text-sm font-medium text-gray-700">Contrase√±a</label>
                                <input id="regPassword" type="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="regCareer" class="block text-sm font-medium text-gray-700">Carrera</label>
                                <select id="regCareer" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione una carrera</option>
                                    <option value="Ingenier√≠a en Sistemas">Ingenier√≠a en Sistemas</option>
                                    <option value="Medicina">Medicina</option>
                                    <option value="Derecho">Derecho</option>
                                    <option value="Administraci√≥n">Administraci√≥n</option>
                                </select>
                            </div>
                            <div>
                                <label for="regSemester" class="block text-sm font-medium text-gray-700">Semestre</label>
                                <select id="regSemester" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">Seleccione un semestre</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="addStudent()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Agregar </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Ocultar modal de registro
        function hideRegisterModal() {
            document.getElementById('registerModal').classList.add('hidden');
        }

        // Registrar nuevo estudiante
        async function registerStudent() {
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const phone = document.getElementById('regPhone').value.trim();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const career = document.getElementById('regCareer').value;
            const semester = document.getElementById('regSemester').value;
            
            // Validaciones
            if (!name || !email || !phone || !username || !password || !confirmPassword || !career || !semester) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Las contrase√±as no coinciden', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('La contrase√±a debe tener al menos 6 caracteres', 'error');
                return;
            }
            
            // Verificar si el nombre de usuario ya existe
            const existingUser = allData.find(item => item.username === username);
            if (existingUser) {
                showNotification('El nombre de usuario ya est√° en uso', 'error');
                return;
            }
            
            showLoading();
            
            // Crear nuevo estudiante
            const newStudent = {
                id: `student_${++studentCounter}`,
                type: 'student',
                name: name,
                email: email,
                phone: phone,
                role: 'estudiante',
                student_id: `STU${studentCounter}`,
                username: username,
                password: password,
                career: career,
                semester: semester,
                courses: JSON.stringify([]),
                status: 'active',
                created_at: new Date().toISOString()
            };
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.create(newStudent);
                if (result.isOk) {
                    showNotification('Registro exitoso. Ahora puede iniciar sesi√≥n', 'success');
                    hideRegisterModal();
                    // Actualizar datos locales
                    allData.push(newStudent);
                } else {
                    showNotification('Error al registrar estudiante', 'error');
                }
            } else {
                // Fallback: agregar directamente al array local
                allData.push(newStudent);
                showNotification('Registro exitoso. Ahora puede iniciar sesi√≥n', 'success');
                hideRegisterModal();
            }
            
            hideLoading();
        }

        // Agregar nuevo estudiante (administrador)
        async function addStudent() {
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const phone = document.getElementById('regPhone').value.trim();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const career = document.getElementById('regCareer').value;
            const semester = document.getElementById('regSemester').value;
            
            // Validaciones
            if (!name || !email || !phone || !username || !password || !career || !semester) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('La contrase√±a debe tener al menos 6 caracteres', 'error');
                return;
            }
            
            // Verificar si el nombre de usuario ya existe
            const existingUser = allData.find(item => item.username === username);
            if (existingUser) {
                showNotification('El nombre de usuario ya est√° en uso', 'error');
                return;
            }
            
            showLoading();
            
            // Generar correo educativo autom√°ticamente
            const emailParts = name.toLowerCase().split(' ');
            const firstName = emailParts[0];
            const lastName = emailParts[emailParts.length - 1];
            const educationalEmail = `${firstName}.${lastName}@universidad.edu`;
            
            // Crear nuevo estudiante con datos iniciales en cero
            const newStudent = {
                id: `student_${++studentCounter}`,
                type: 'student',
                name: name,
                email: educationalEmail, // Usar correo educativo generado
                phone: phone,
                role: 'estudiante',
                student_id: `STU${String(studentCounter).padStart(4, '0')}`,
                username: username,
                password: password,
                career: career,
                semester: semester,
                courses: JSON.stringify([]), // Inicialmente sin cursos
                grades: JSON.stringify({}), // Inicialmente sin calificaciones
                assignments: JSON.stringify([]), // Inicialmente sin tareas
                attendance: JSON.stringify({}), // Inicialmente sin asistencia
                payments: JSON.stringify([]), // Inicialmente sin pagos
                status: 'active',
                created_at: new Date().toISOString()
            };
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.create(newStudent);
                if (result.isOk) {
                    showNotification('Estudiante registrado exitosamente', 'success');
                    hideRegisterModal();
                    // Actualizar datos locales
                    allData.push(newStudent);
                    loadStudentsContent();
                    // Actualizar panel de estudiantes en tiempo real
                    updateStudentsDashboard();
                } else {
                    showNotification('Error al registrar estudiante', 'error');
                }
            } else {
                // Fallback: agregar directamente al array local
                allData.push(newStudent);
                showNotification('Estudiante registrado exitosamente', 'success');
                hideRegisterModal();
                loadStudentsContent();
                // Actualizar panel de estudiantes en tiempo real
                updateStudentsDashboard();
            }
            
            hideLoading();
        }

        // Actualizar panel de estudiantes en tiempo real
        function updateStudentsDashboard() {
            // Esta funci√≥n se encarga de actualizar las estad√≠sticas en tiempo real
            // cuando se registra un nuevo estudiante
            
            // Contar estudiantes por carrera
            const studentsByCareer = {};
            const activeStudents = allData.filter(item => item.type === 'student' && item.status === 'active');
            
            activeStudents.forEach(student => {
                if (!studentsByCareer[student.career]) {
                    studentsByCareer[student.career] = 0;
                }
                studentsByCareer[student.career]++;
            });
            
            // Actualizar estad√≠sticas si estamos en el dashboard
            if (document.getElementById('dashboard-content') && !document.getElementById('contentArea').innerHTML.includes('Funcionalidad en desarrollo')) {
                // Actualizar contadores en el dashboard
                const totalStudentsElement = document.querySelector('#total-students-count');
                if (totalStudentsElement) {
                    totalStudentsElement.textContent = activeStudents.length;
                }
                
                // Actualizar gr√°fico de distribuci√≥n por carrera si existe
                const careerChart = document.querySelector('#career-distribution');
                if (careerChart) {
                    // Simular actualizaci√≥n del gr√°fico
                    console.log('Actualizando gr√°fico de distribuci√≥n por carrera');
                }
            }
        }

        // Editar estudiante
        function editStudent(studentId) {
            const student = allData.find(item => item.id === studentId);
            if (!student) return;
            
            const modal = document.getElementById('registerModal');
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Editar Estudiante</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="editName" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                                <input id="editName" type="text" value="${student.name}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="editEmail" class="block text-sm font-medium text-gray-700">Email</label>
                                <input id="editEmail" type="email" value="${student.email}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="editPhone" class="block text-sm font-medium text-gray-700">Tel√©fono</label>
                                <input id="editPhone" type="text" value="${student.phone}" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="editCareer" class="block text-sm font-medium text-gray-700">Carrera</label>
                                <select id="editCareer" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="Ingenier√≠a en Sistemas" ${student.career === 'Ingenier√≠a en Sistemas' ? 'selected' : ''}>Ingenier√≠a en Sistemas</option>
                                    <option value="Medicina" ${student.career === 'Medicina' ? 'selected' : ''}>Medicina</option>
                                    <option value="Derecho" ${student.career === 'Derecho' ? 'selected' : ''}>Derecho</option>
                                    <option value="Administraci√≥n" ${student.career === 'Administraci√≥n' ? 'selected' : ''}>Administraci√≥n</option>
                                </select>
                            </div>
                            <div>
                                <label for="editSemester" class="block text-sm font-medium text-gray-700">Semestre</label>
                                <select id="editSemester" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="1" ${student.semester === '1' ? 'selected' : ''}>1</option>
                                    <option value="2" ${student.semester === '2' ? 'selected' : ''}>2</option>
                                    <option value="3" ${student.semester === '3' ? 'selected' : ''}>3</option>
                                    <option value="4" ${student.semester === '4' ? 'selected' : ''}>4</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="hideRegisterModal()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"> Cancelar </button>
                            <button onclick="updateStudent('${studentId}')" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700"> Guardar </button>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        // Actualizar estudiante
        async function updateStudent(studentId) {
            const student = allData.find(item => item.id === studentId);
            if (!student) return;
            
            const name = document.getElementById('editName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const career = document.getElementById('editCareer').value;
            const semester = document.getElementById('editSemester').value;
            
            // Validaciones
            if (!name || !email || !phone || !career || !semester) {
                showNotification('Por favor complete todos los campos', 'error');
                return;
            }
            
            showLoading();
            
            // Actualizar datos del estudiante
            student.name = name;
            student.email = email;
            student.phone = phone;
            student.career = career;
            student.semester = semester;
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.update(student);
                if (result.isOk) {
                    showNotification('Estudiante actualizado exitosamente', 'success');
                    hideRegisterModal();
                    loadStudentsContent();
                } else {
                    showNotification('Error al actualizar estudiante', 'error');
                }
            } else {
                // Fallback: los cambios ya est√°n en el array local
                showNotification('Estudiante actualizado exitosamente', 'success');
                hideRegisterModal();
                loadStudentsContent();
            }
            
            hideLoading();
        }

        // Cambiar estado del estudiante
        async function toggleStudentStatus(studentId) {
            const student = allData.find(item => item.id === studentId);
            if (!student) return;
            
            showLoading();
            
            // Cambiar estado
            student.status = student.status === 'active' ? 'inactive' : 'active';
            
            // Guardar en la base de datos
            if (window.dataSdk) {
                const result = await window.dataSdk.update(student);
                if (result.isOk) {
                    showNotification(`Estudiante ${student.status === 'active' ? 'activado' : 'desactivado'} exitosamente`, 'success');
                    loadStudentsContent();
                } else {
                    showNotification('Error al cambiar estado del estudiante', 'error');
                }
            } else {
                // Fallback: los cambios ya est√°n en el array local
                showNotification(`Estudiante ${student.status === 'active' ? 'activado' : 'desactivado'} exitosamente`, 'success');
                loadStudentsContent();
            }
            
            hideLoading();
        }

        // BLOQUE 17: INICIALIZACI√ìN AL CARGAR LA P√ÅGINA
        // Inicializar la aplicaci√≥n cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'996fa07c87d4b0bc',t:'MTc2MTg3Njc0MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>